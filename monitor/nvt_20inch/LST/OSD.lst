C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 1   


C51 COMPILER V7.03, COMPILATION OF MODULE OSD
OBJECT MODULE PLACED IN .\BIN\OSD.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE SRC\OSD.C OPTIMIZE(9,SPEED) DEFINE(X21) DEBUG OBJECTEXTEND PRINT(.\LST\OSD.
                    -lst) OBJECT(.\BIN\OSD.obj)

stmt level    source

   1          #include "stdio.h"
   2          #include "OSD.H"
   3          #include "Scaler.H"
   4          #include "IIC.H"
   5          #include "MyDef.H"
   6          #include "RAM.H"
   7          #include "F63XREG.H"
   8          #include "F63XDEF.H"
   9          #include "MCU.H"
  10          #include "OSD_TAB.H"
  11          #include "OSD_TAB2.H"
  12          #include "ROM_MAP.H"
  13          #include "PANEL.H"
  14          #include "UserAdj.H"
  15          #include "ModeHandle.H"
  16          #include "Tuner.h"
  17          #include "Z86229.h"
  18          
  19          
  20                  
  21          void OsdProcess()
  22          {
  23   1              if(MenuPtr.Op == 0)
  24   1                      return;
  25   1              if(MenuPtr.Menu == 1)
  26   1                      {
  27   2                      if(MenuPtr.Level == 0)
  28   2                              {
  29   3                              switch(MenuPtr.Op)
  30   3                                      {
  31   4                                      case oUPDATEALL:
  32   4                                              ShowMain(MenuPtr.Page);
  33   4                                              Osd_On(enWIN4|enWIN2);  //win4 background /win3 select icon 
  34   4                                              TempPtr = FuncBuf[pVIDEOSOURCE];
  35   4                                              break;
  36   4                                      case oUPDATE:
  37   4                                              ShowKeyMenu(MenuPtr.Page,MenuPtr.Level);        //when change page
  38   4                                      case oINCPAGE:
  39   4                                      case oDECPAGE:
  40   4                                              ClearTextArea();
  41   4                                              RefreshIcon();  
  42   4                                              ShowSubMenu(MenuPtr.Page,MenuPtr.Ptr);
  43   4                                              break;
  44   4                                      };
  45   3                              }
  46   2                      if(MenuPtr.Level == 1)
  47   2                              {
  48   3                              switch(MenuPtr.Op)
  49   3                                      {
  50   4                                      case oENTER:
  51   4                                      case oUPDATEALL:
  52   4                                              ShowKeyMenu(MenuPtr.Page,MenuPtr.Level);        //when chane level 0 -->level 1
  53   4                                      case oDECFUNC:
  54   4                                      case oINCFUNC:
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 2   

  55   4                                              ShowSubMenu(MenuPtr.Page,MenuPtr.Ptr);
  56   4                                              break;
  57   4                                      case oUPDATE:
  58   4                                      case oINCVAL://do not add 'break' here
  59   4                                      case oDECVAL:
  60   4                                              switch(FuncPtr)
  61   4                                                      {
  62   5                                                      //case pTEXTMODE:
  63   5                                                      //      ShowTextGraphicMode();
  64   5                                                      //      break;
  65   5                                                      case pRECALL:
  66   5                                                              ShowYesNo(0);
  67   5                                                              ShowSubMenu(MenuPtr.Page,MenuPtr.Ptr);
  68   5                                                              break;
  69   5                                                      case pLANGUAGE:
  70   5                                                              ShowLanguage();
  71   5                                                              break;
  72   5                                                      case pVIDEOSOURCE:
  73   5                                                              ShowSyncMode();
  74   5                                                              break;
  75   5                                                      case pCOLORTEMP:
  76   5                                                              if(FuncBuf[pCOLORTEMP] == 3 || FuncBuf[pCOLORTEMP] == 0 )//change key when first and user item 
  77   5                                                                      ShowKeyMenu(2,MenuPtr.Level);
  78   5                                                              ShowColorMenu();
  79   5                                                              break;
  80   5                                                      case pMUTE:
  81   5                                                              ShowOnOff(AudioMute);
  82   5                                                              ShowStatus(ROW11+2,fGREEN|bBLACK);
  83   5                                                              break;
  84   5                                                      case pAUTOSETTING:
  85   5                                                              ShowOnOff(AutoSetting);
  86   5                                                              break;
  87   5                                                      case pOSDHPOSITION:
  88   5                                                              ShowOSDPosition();
  89   5                                                              break;
  90   5                                                      case pSHARPNESS:
  91   5                                                              if(FuncBuf[pVIDEOSOURCE] < cSVIDEO)
  92   5                                                                      ShowSharpness();
  93   5                                                              else{
  94   6                                                                      ShowBar(MAINMENU_BAR_ADDR+(OSD_WIDTH*MenuPtr.Ptr),BAR_COLOR,FuncMin,FuncMax,FuncBuf[FuncPtr]);
  95   6                                                                      ShowValue(MAINMENU_VALUE_ADDR+(OSD_WIDTH*MenuPtr.Ptr),VALUE_COLOR,FuncBuf[FuncPtr]);
  96   6                                                              }
  97   5                                                              break;
  98   5                                                      case pLIGHTEN:
  99   5                                                              ShowOnOff(LightEn);
 100   5                                                              break;
 101   5                                                      case pSCALERMODE:
 102   5      //                                                      ShowScalerMode(ScalerMode);
 103   5                                                              break;
 104   5                                                      case pCAPTION:
 105   5                                                              ShowOnOff(CaptionFlag);
 106   5                                                              break;  
 107   5              //                                      case pVOLUME:
 108   5      /*                                              case pTreble:
 109   5                                                              ShowBar(MAINMENU_BAR_ADDR+(OSD_WIDTH*MenuPtr.Ptr),BAR_COLOR,FuncMin,FuncMax,FuncBuf[pTreble] );
 110   5                                                              ShowValue(MAINMENU_VALUE_ADDR+(OSD_WIDTH*MenuPtr.Ptr),VALUE_COLOR,Treble);
 111   5                                                              break;
 112   5                                                      case pBass:     
 113   5                                                              ShowBar(MAINMENU_BAR_ADDR+(OSD_WIDTH*MenuPtr.Ptr),BAR_COLOR,FuncMin,FuncMax,FuncBuf[pBass] );
 114   5                                                              ShowValue(MAINMENU_VALUE_ADDR+(OSD_WIDTH*MenuPtr.Ptr),VALUE_COLOR,Bass);
 115   5                                                              break;
 116   5      //                                                      ShowOnOff(AudioMute);
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 3   

 117   5      //                                                      ShowStatus(ROW11+2,fGREEN|bBLACK);
 118   5                                                      //      break;
 119   5      */
 120   5                                                      default:
 121   5                                                              ShowBar(MAINMENU_BAR_ADDR+(OSD_WIDTH*MenuPtr.Ptr),BAR_COLOR,FuncMin,FuncMax,FuncBuf[FuncPtr]);
 122   5                                                              ShowValue(MAINMENU_VALUE_ADDR+(OSD_WIDTH*MenuPtr.Ptr),VALUE_COLOR,FuncBuf[FuncPtr]);
 123   5                                                              break;
 124   5                                                      };
 125   4                                              break;
 126   4                                      };
 127   3                              }
 128   2                      if(MenuPtr.Level == 2)
 129   2                              {
 130   3                              switch(MenuPtr.Op)
 131   3                                      {
 132   4                                      case oUPDATE:
 133   4                                              ShowKeyMenu(2,MenuPtr.Level);
 134   4                                      case oDECFUNC:
 135   4                                      case oINCFUNC:
 136   4                                              if(FuncBuf[pCOLORTEMP] == 3)
 137   4                                                      ShowUserRGBMenu();
 138   4                                              break;
 139   4                                      case oINCVAL://do not add 'break' here
 140   4                                      case oDECVAL:
 141   4                                              switch(FuncPtr)
 142   4                                                      {
 143   5                                                      case pRCOLOR:
 144   5                                                      case pGCOLOR:
 145   5                                                      case pBCOLOR:
 146   5                                                              if(FuncBuf[pCOLORTEMP] == 3)
 147   5                                                                      ShowRGBMenu();
 148   5                                                              break;
 149   5                                                      case pVIDEOSOURCE:
 150   5                                                              ShowSyncMode();
 151   5                                                              break;
 152   5                                                      };
 153   4                                              break;
 154   4                                      };
 155   3                              }
 156   2                      }
 157   1              if(MenuPtr.Menu == 2)   //fact menu
 158   1                      {
 159   2                      if(MenuPtr.Level == 0)
 160   2                              {
 161   3                              switch(MenuPtr.Op)
 162   3                                      {
 163   4                                      case oUPDATEALL:
 164   4                                              ShowFactMenu();
 165   4                                              Osd_On(enWIN4|enWIN3);          
 166   4                                              break;
 167   4                                      case oUPDATE:
 168   4                                      case oENTER:
 169   4                                      case oINCFUNC:
 170   4                                      case oDECFUNC:
 171   4                                              ShowFact();
 172   4                                              break;
 173   4                                      };
 174   3                              }
 175   2                      if(MenuPtr.Level == 1)
 176   2                              {
 177   3                              switch(MenuPtr.Op)
 178   3                                      {
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 4   

 179   4                                      case oENTER:
 180   4                                      case oDECVAL:
 181   4                                      case oINCVAL:
 182   4                                              ShowFact();
 183   4                                              break;
 184   4                                      }
 185   3                              }
 186   2                      }
 187   1              if(MenuPtr.Menu == 3)
 188   1              {
 189   2                      if(MenuPtr.Level == 0)
 190   2                              {
 191   3                              switch(MenuPtr.Op)
 192   3                                      {
 193   4                                      case oUPDATEALL:
 194   4                                              ShowBrightnessMenu();
 195   4                                              Osd_On(enWIN4); //win4 background /win3 select icon 
 196   4                                              TempPtr = FuncBuf[pVIDEOSOURCE];
 197   4                                              break;
 198   4                                      case oINCVAL://do not add 'break' here
 199   4                                      case oDECVAL:
 200   4                                              ShowBar(MAINMENU_BAR_ADDR,BAR_COLOR,FuncMin,FuncMax,FuncBuf[FuncPtr]);
 201   4                                              ShowValue(MAINMENU_VALUE_ADDR,VALUE_COLOR,FuncBuf[FuncPtr]);
 202   4                                              break;
 203   4                                      };
 204   3                              }
 205   2                      if(MenuPtr.Level == 1)
 206   2                              {
 207   3                              switch(MenuPtr.Op)
 208   3                                      {
 209   4                                      case oUPDATEALL:
 210   4                                              ShowBrightnessMenu();
 211   4                                              Osd_On(enWIN4); //win4 background /win3 select icon 
 212   4                                              break;
 213   4                                      case oDECFUNC:
 214   4                                      case oINCFUNC:
 215   4                                              ClearLine(1);
 216   4                                              ShowDesc(FuncPtr,HOTKEYMENU_DESC_ADDR,SEL_FUN_COLOR);
 217   4                                              ShowKeyMenu(0,MenuPtr.Level);
 218   4                                      case oINCVAL://do not add 'break' here
 219   4                                      case oDECVAL:
 220   4                                              ShowBar(HOTKEYMENU_BAR_ADDR,BAR_COLOR,FuncMin,FuncMax,FuncBuf[FuncPtr]);
 221   4                                              ShowValue(HOTKEYMENU_VALUE_ADDR,VALUE_COLOR,FuncBuf[FuncPtr]);
 222   4                                              break;
 223   4                                      };
 224   3                              }
 225   2                      }
 226   1              
 227   1              if(MenuPtr.Menu == 4)
 228   1              {
 229   2                      switch(MenuPtr.Op)
 230   2                              {
 231   3                              case oUPDATEALL:
 232   3                                      ShowTurboModeMenu();
 233   3                                      Osd_On(enWIN4); //win4 background /win3 select icon 
 234   3                                      break;
 235   3                              case oINCVAL://do not add 'break' here
 236   3                              case oDECVAL:
 237   3                                      ShowTurboMode();
 238   3                                      break;
 239   3                              };
 240   2              }
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 5   

 241   1      
 242   1              if(MenuPtr.Menu == 5)
 243   1              {
 244   2                      switch(MenuPtr.Op)
 245   2                              {
 246   3                              case oUPDATEALL:
 247   3                                      ShowMain(MenuPtr.Page);
 248   3                                      Osd_On(enWIN4|enWIN2);  //win4 background /win3 select icon 
 249   3                                      //TempPtr = FuncBuf[pVIDEOSOURCE];
 250   3                              case oENTER:
 251   3                              case oDECFUNC:
 252   3                              case oINCFUNC:
 253   3                                      ShowKeyMenu(MenuPtr.Page,MenuPtr.Level);
 254   3                                      ShowSubMenu(MenuPtr.Page,MenuPtr.Ptr);
 255   3                                      break;
 256   3                              };
 257   2              }
 258   1              
 259   1      //---------------------------- +jwshin 050801
 260   1              if(MenuPtr.Menu == 6)
 261   1              {
 262   2                      if(MenuPtr.Level == 0)
 263   2                              {
 264   3                              switch(MenuPtr.Op)
 265   3                                      {
 266   4                                      case oUPDATEALL:
 267   4                                                      WriteIIC563(0x080,0); // OSD disable
 268   4                                                      ClearOSD();
 269   4                                                      WriteIIC563(0x090,0x00);  // zooming off
 270   4                                                      ShowOSDFrame(1);
 271   4                                                      OsdPosition();
 272   4                                                      OpenWindow(WINDOW4,WIN4_X1,WIN4_X2,WIN4_Y1,WIN4_Y2-9,WIN4_ATTR,WIN4_COLOR);
 273   4                                                      OpenWindow(WINDOW3,WIN3_X1,WIN3_X2,WIN3_Y1,WIN3_Y2,WIN3_ATTR,WIN3_COLOR);
 274   4                                                      if(FuncBuf[pVIDEOSOURCE] < cSVIDEO){
 275   5                                                              //ShowResolution(HOTKEYMENU_RES_ADDR,RES_COLOR);
 276   5                                                              ShowStatus(ROW2+2,fGREEN|bBLACK);
 277   5                                                      }
 278   4                                                      //else
 279   4                                                      //      ShowTvSystem();
 280   4                                                      ShowKeyMenu(1,MenuPtr.Level);
 281   4                                                      
 282   4                                                      FuncPtr = Page1Item[MenuPtr.Ptr];
 283   4                                                      ShowDesc(FuncPtr,HOTKEYMENU_DESC_ADDR,SEL_FUN_COLOR);
 284   4                                                      GetFuncRange(FuncPtr);
 285   4                                                      ShowBar(HOTKEYMENU_BAR_ADDR,SEL_FUN_COLOR,FuncMin,FuncMax,FuncBuf[FuncPtr]);
 286   4                                                      ShowValue(HOTKEYMENU_VALUE_ADDR,SEL_FUN_COLOR,FuncBuf[FuncPtr]);
 287   4                                              Osd_On(enWIN4); //win4 background /win3 select icon 
 288   4                                              TempPtr = FuncBuf[pVIDEOSOURCE];
 289   4                                              break;
 290   4                                      case oINCVAL://do not add 'break' here
 291   4                                      case oDECVAL:
 292   4                                              ShowBar(MAINMENU_BAR_ADDR,BAR_COLOR,FuncMin,FuncMax,FuncBuf[FuncPtr]);
 293   4                                              ShowValue(MAINMENU_VALUE_ADDR,VALUE_COLOR,FuncBuf[FuncPtr]);
 294   4                                              break;
 295   4                                      };
 296   3                              }
 297   2                      if(MenuPtr.Level == 1)
 298   2                              {
 299   3                              switch(MenuPtr.Op)
 300   3                                      {
 301   4                                      case oUPDATEALL:
 302   4                                                      WriteIIC563(0x080,0); // OSD disable
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 6   

 303   4                                                      ClearOSD();
 304   4                                                      WriteIIC563(0x090,0x00);  // zooming off
 305   4                                                      ShowOSDFrame(1);
 306   4                                                      OsdPosition();
 307   4                                                      OpenWindow(WINDOW4,WIN4_X1,WIN4_X2,WIN4_Y1,WIN4_Y2-9,WIN4_ATTR,WIN4_COLOR);
 308   4                                                      OpenWindow(WINDOW3,WIN3_X1,WIN3_X2,WIN3_Y1,WIN3_Y2,WIN3_ATTR,WIN3_COLOR);
 309   4                                                      if(FuncBuf[pVIDEOSOURCE] < cSVIDEO){
 310   5                                                              //ShowResolution(HOTKEYMENU_RES_ADDR,RES_COLOR);
 311   5                                                              ShowStatus(ROW2+2,fGREEN|bBLACK);
 312   5                                                      }
 313   4                                                      //else
 314   4                                                      //      ShowTvSystem();
 315   4                                                      ShowKeyMenu(1,MenuPtr.Level);
 316   4                                                      
 317   4                                                      FuncPtr = Page1Item[MenuPtr.Ptr];
 318   4                                                      ShowDesc(FuncPtr,HOTKEYMENU_DESC_ADDR,SEL_FUN_COLOR);
 319   4                                                      GetFuncRange(FuncPtr);
 320   4                                                      ShowBar(HOTKEYMENU_BAR_ADDR,SEL_FUN_COLOR,FuncMin,FuncMax,FuncBuf[FuncPtr]);
 321   4                                                      ShowValue(HOTKEYMENU_VALUE_ADDR,SEL_FUN_COLOR,FuncBuf[FuncPtr]);
 322   4                                                      Osd_On(enWIN4); //win4 background /win3 select icon 
 323   4                                                      break;
 324   4                                      case oDECFUNC:
 325   4                                      case oINCFUNC:
 326   4                                              ClearLine(1);
 327   4                                              ShowDesc(FuncPtr,HOTKEYMENU_DESC_ADDR,SEL_FUN_COLOR);
 328   4                                              ShowKeyMenu(1,MenuPtr.Level);
 329   4                                      case oINCVAL://do not add 'break' here
 330   4                                      case oDECVAL:
 331   4                                              ShowBar(HOTKEYMENU_BAR_ADDR,BAR_COLOR,FuncMin,FuncMax,FuncBuf[FuncPtr]);
 332   4                                              ShowValue(HOTKEYMENU_VALUE_ADDR,VALUE_COLOR,FuncBuf[FuncPtr]);
 333   4                                              break;
 334   4                                      };
 335   3                              }
 336   2              }       
 337   1      //------------------------------------  
 338   1              
 339   1              
 340   1              MenuPtr.Op = 0;
 341   1      }
 342          
 343          void ShowSyncMode()
 344          {
 345   1              Byte code ENG_ANALOG[]={
 346   1                      6,"Analog"
 347   1              };
 348   1              Byte code FRA_ANALOG[]={
 349   1                      10,"Analogique"
 350   1              };
 351   1              Byte code DEU_ANALOG[]={
 352   1                      5,"Analog"
 353   1              };
 354   1              Byte code ESP_ANALOG[]={
 355   1                      9,"Analgica"
 356   1              };
 357   1              Byte code ITA_ANALOG[]={
 358   1                      9,"Analogico"
 359   1              };
 360   1              Byte code JAP_ANALOG[]={
 361   1                      4,_J19,_J1a,_J10,_J13
 362   1              };
 363   1              Byte code RUS_ANALOG[]={
 364   1                      10,_A,_P04,_a,_P19,_o,_P0a,_o,_P07,_P1a,_P02
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 7   

 365   1              };
 366   1              Byte code CHT_ANALOG[]={
 367   1                      2,_C61,_C21
 368   1              };
 369   1              Byte code CHI_ANALOG[]={
 370   1                      2,_C32,_C33
 371   1              };
 372   1              Byte code ENG_DVI[]={
 373   1              7,"DigitalL"
 374   1              };
 375   1              Byte code FRA_DVI[]={
 376   1              9,"Numrique"
 377   1              };
 378   1              Byte code DEU_DVI[]={
 379   1              7,"Digital"
 380   1              };
 381   1              Byte code ESP_DVI[]={
 382   1              7,"Digital"
 383   1              };
 384   1              Byte code ITA_DVI[]={
 385   1              8,"Digitale"
 386   1              };
 387   1              Byte code JAP_DVI[]={
 388   1              4,_J14,_J1b,_J1c,_J18
 389   1              };
 390   1              Byte code RUS_DVI[]={
 391   1              6,_P06,_P03,_P15,_p,_o,_P07,_o,_P02
 392   1              };
 393   1              Byte code CHT_DVI[]={
 394   1              2,_C62,_C14
 395   1              };
 396   1              Byte code CHI_DVI[]={
 397   1              2,_C34,_C27
 398   1              };
 399   1              Byte code ENG_YPbPr[]={
 400   1              5,"YPbPr"
 401   1              };
 402   1              Byte code ENG_CVBS[]={
 403   1                      5,"Video"
 404   1              };
 405   1              Byte code ENG_SVIDEO[]={
 406   1                      7,"S-Video"
 407   1              };
 408   1              Byte code TXT_TV[]={
 409   1                      2,"TV"
 410   1              };
 411   1      code unsigned char *SourceTab[][9]={
 412   1              {ENG_ANALOG,FRA_ANALOG,DEU_ANALOG,ESP_ANALOG,ITA_ANALOG,JAP_ANALOG,RUS_ANALOG,CHT_ANALOG,CHI_ANALOG},
 413   1              {ENG_DVI,FRA_DVI,DEU_DVI,ESP_DVI,ITA_DVI,JAP_DVI,RUS_DVI,CHT_DVI,CHI_DVI},
 414   1              {ENG_YPbPr,ENG_YPbPr,ENG_YPbPr,ENG_YPbPr,ENG_YPbPr,ENG_YPbPr,ENG_YPbPr,ENG_YPbPr,ENG_YPbPr},
 415   1              {ENG_SVIDEO,ENG_SVIDEO,ENG_SVIDEO,ENG_SVIDEO,ENG_SVIDEO,ENG_SVIDEO,ENG_SVIDEO,ENG_SVIDEO,ENG_SVIDEO},
 416   1              {ENG_CVBS,ENG_CVBS,ENG_CVBS,ENG_CVBS,ENG_CVBS,ENG_CVBS,ENG_CVBS,ENG_CVBS,ENG_CVBS},
 417   1              {TXT_TV,TXT_TV,TXT_TV,TXT_TV,TXT_TV,TXT_TV,TXT_TV,TXT_TV,TXT_TV}
 418   1      };
 419   1      
 420   1              Byte i,End,x,y,*Offset,Length;
 421   1              Word code SyncModeAddr[6]={ROW4+2,ROW5+2,ROW6+2,ROW7+2,ROW8+2,ROW9+2};
 422   1      
 423   1      
 424   1              Osd_On(enWIN4|enWIN2);
 425   1              if(DecoderICEn)
 426   1                      End = 6;
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 8   

 427   1              else
 428   1                      End = 3;
 429   1              //i = TempPtr;
 430   1              i = MenuPtr.Ptr;
 431   1              x = SyncModeAddr[i] % OSD_WIDTH;
 432   1              y = SyncModeAddr[i] / OSD_WIDTH;
 433   1              //if(MenuPtr.Level == 1) 
 434   1                      //OpenWindow(WINDOW3,x,x+10,y,y,atWIN_SHADOW_4L,WIN3_COLOR);
 435   1      //      x = Read24C16(ep_Sync_Source);
 436   1              for(i=0;i<End;i++)
 437   1                      {
 438   2                      Offset = SourceTab[i][FuncBuf[pLANGUAGE]];
 439   2                      Length = *Offset;
 440   2                      Offset++;
 441   2      //              if(MenuPtr.Level == 1)
 442   2      //                      if(i == MenuPtr.Ptr)
 443   2      //                              WriteWordIIC563(0x0cc,fMAGENTA|fBLACK);
 444   2      //                      else
 445   2      //                              WriteWordIIC563(0x0cc,fWHITE|fBLACK);
 446   2      //              else
 447   2      //                      if(FuncBuf[pVIDEOSOURCE] == i)
 448   2      //                              WriteWordIIC563(0x0cc,fGREEN|fBLACK);
 449   2      //                      else                    
 450   2      //                              WriteWordIIC563(0x0cc,fWHITE|fBLACK);
 451   2                      if(i == MenuPtr.Ptr && MenuPtr.Level == 1)
 452   2                              WriteWordIIC563(0x0cc,fMAGENTA|fBLACK);
 453   2                      else if(FuncBuf[pVIDEOSOURCE] == i && MenuPtr.Level == 0)
 454   2                              WriteWordIIC563(0x0cc,fGREEN|fBLACK);
 455   2                      else                    
 456   2                              WriteWordIIC563(0x0cc,fWHITE|fBLACK);
 457   2                      //if(i == FuncBuf[pVIDEOSOURCE])
 458   2      //              if(i == MenuPtr.Ptr && MenuPtr.Level == 1)
 459   2      //                      WriteWordIIC563(0x0cc,fMAGENTA|fBLACK);
 460   2      //              else                    
 461   2      //                      WriteWordIIC563(0x0cc,fWHITE|fBLACK);
 462   2                      WriteSeqIndexPort(SyncModeAddr[i],tySRAM_CODE_CC_CD,Offset,Length);
 463   2                      }
 464   1              if(MenuPtr.Level == 1) 
 465   1                      Osd_On(enWIN4|enWIN2);
 466   1      }
 467          /*
 468          void ShowTextGraphicMode()
 469          {
 470                  Byte code TextModeTab[]={"Text"};
 471                  Byte code GraphicModeTab[]={"Graphic"};
 472                  if(TextMode && GTmodeEn)
 473                          WriteWordIIC563(0x0cc,fRED|fBLACK);
 474                  else
 475                          WriteWordIIC563(0x0cc,fYELLOW|fBLACK);
 476                  WriteSeqIndexPort(ROW9+16,tySRAM_CODE_CC_CD,TextModeTab,4);
 477                  if(!TextMode && GTmodeEn)
 478                          WriteWordIIC563(0x0cc,fRED|fBLACK);
 479                  else
 480                          WriteWordIIC563(0x0cc,fYELLOW|fBLACK);
 481                  WriteSeqIndexPort(ROW9+7,tySRAM_CODE_CC_CD,GraphicModeTab,7);
 482          }
 483          */
 484          void ShowYesNo(Byte Ptr)
 485          {
 486   1      code unsigned char ENG_NO[]={
 487   1              2,"No"
 488   1      };
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 9   

 489   1      code unsigned char FRA_NO[]={
 490   1              3,"Non"
 491   1      };
 492   1      code unsigned char DEU_NO[]={
 493   1              4,"Nein"
 494   1      };
 495   1      code unsigned char ESP_NO[]={
 496   1              2,"No."
 497   1      };
 498   1      code unsigned char ITA_NO[]={
 499   1              2,"No"
 500   1      };
 501   1      code unsigned char JAP_NO[]={
 502   1              2,"No"
 503   1      };
 504   1      code unsigned char RSU_NO[]={
 505   1              3,_H,_e,_P05
 506   1      };
 507   1      code unsigned char CHT_NO[]={
 508   1              1,_C49
 509   1      };
 510   1      code unsigned char CHI_NO[]={
 511   1              1,_C49
 512   1      };
 513   1      
 514   1      code unsigned char ENG_YES[]={
 515   1              3,"Yes"
 516   1      };
 517   1      code unsigned char FRA_YES[]={
 518   1              3,"Oui"
 519   1      };
 520   1      code unsigned char DEU_YES[]={
 521   1              2,"Ja"
 522   1      };
 523   1      code unsigned char ESP_YES[]={
 524   1              2,"Si"
 525   1      };
 526   1      code unsigned char ITA_YES[]={
 527   1              2,"Si"
 528   1      };
 529   1      code unsigned char JAP_YES[]={
 530   1              3,"Yes"
 531   1      };
 532   1      code unsigned char RSU_YES[]={
 533   1              2,_P0f,_a
 534   1      };
 535   1      code unsigned char CHT_YES[]={
 536   1              1,_C4a
 537   1      };
 538   1      code unsigned char CHI_YES[]={
 539   1              1,_C4a
 540   1      };
 541   1      
 542   1      code unsigned char *YesNoTab[][9]={
 543   1              {ENG_NO,FRA_NO,DEU_NO,ESP_NO,ITA_NO,JAP_NO,RSU_NO,CHT_NO,CHI_NO},
 544   1              {ENG_YES,FRA_YES,DEU_YES,ESP_YES,ITA_YES,JAP_YES,RSU_YES,CHT_YES,CHI_YES}
 545   1      };
 546   1              Byte i;
 547   1              Word code YesNoAddr[]={ROW8+17,ROW8+24};
 548   1              Byte *Offset,Length;
 549   1      
 550   1              
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 10  

 551   1              for(i=0;i<2;i++)
 552   1              {
 553   2                      Offset = YesNoTab[i][FuncBuf[pLANGUAGE]];
 554   2                      Length = *Offset;
 555   2                      Offset++;
 556   2                      if(Ptr == i)
 557   2                              if(((FuncPtr == pRECALL && MenuPtr.Ptr == 4)) && MenuPtr.Level == 1)
 558   2                                      WriteWordIIC563(0x0cc,fMAGENTA|fBLACK);
 559   2                              else
 560   2                                      WriteWordIIC563(0x0cc,fGREEN|fBLACK);
 561   2                      else
 562   2                              WriteWordIIC563(0x0cc,fWHITE|fBLACK);
 563   2                      WriteSeqIndexPort(YesNoAddr[i],tySRAM_CODE_CC_CD,Offset,Length);
 564   2              }
 565   1      }
 566          
 567          void ShowLanguage()
 568          {
 569   1      code unsigned char ENGStr[]={
 570   1              8,"English "
 571   1      };
 572   1      code unsigned char FRAStr[]={
 573   1              8,"Franais"
 574   1      };
 575   1      code unsigned char DEUStr[]={
 576   1              8,"Deutsch "
 577   1      };
 578   1      code unsigned char ESPStr[]={
 579   1              8,"Espaol "
 580   1      };
 581   1      code unsigned char ITAStr[]={
 582   1              8,"Italiano"
 583   1      };
 584   1      code unsigned char JAPStr[]={
 585   1              3,_C07,_C08,_C09
 586   1      };
 587   1      code unsigned char RUSStr[]={
 588   1              7,_P,_y,_c,_c,_P00,_P03,_P02
 589   1      };
 590   1      code unsigned char CHTStr[]={
 591   1              4,_C05,_C06,_C01,_C02
 592   1      };
 593   1      code unsigned char CHIStr[]={
 594   1              4,_C03,_C04,_C01,_C02
 595   1      };
 596   1              Byte code *LanguageTab[]={
 597   1              ENGStr,FRAStr,DEUStr,ESPStr,ITAStr,JAPStr,RUSStr,CHTStr,CHIStr
 598   1      };
 599   1      
 600   1              Word code LanguageAddr[9]={ROW4+2,ROW5+2,ROW6+2,ROW7+2,ROW8+2,ROW4+15,ROW5+15,ROW6+15,ROW7+15};
 601   1              Byte *Offset,i,Length;
 602   1      
 603   1              for(i=0;i<MAX_LANGUAGE;i++)
 604   1                      {
 605   2      //              if(i == MenuPtr.Ptr && MenuPtr.Level == 1)
 606   2      //                      WriteWordIIC563(0x0cc,fMAGENTA|fBLACK);
 607   2      //              else                    
 608   2      //                      WriteWordIIC563(0x0cc,fWHITE|fBLACK);
 609   2                      if(FuncBuf[pLANGUAGE] == i)
 610   2                              if(MenuPtr.Level == 1)
 611   2                                      WriteWordIIC563(0x0cc,fMAGENTA|fBLACK);
 612   2                              else
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 11  

 613   2                                      WriteWordIIC563(0x0cc,fGREEN|fBLACK);
 614   2                      else                    
 615   2                              WriteWordIIC563(0x0cc,fWHITE|fBLACK);
 616   2                      Offset = LanguageTab[i];
 617   2                      Length = *Offset;
 618   2                      Offset++;
 619   2                      WriteSeqIndexPort(LanguageAddr[i],tySRAM_CODE_CC_CD,Offset,Length);
 620   2              }
 621   1              if(MenuPtr.Level !=0)
 622   1                      ShowKeyMenu(3,MenuPtr.Level);
 623   1      }
 624          
 625          void ShowColorMenu()
 626          {
 627   1              Byte i,*Offset,Length;
 628   1              Byte code ColorTab[][5]={{"9300K"},{"7500K"},{"6500K"},{"     "}};
 629   1              Word code ColorAddr[]={ROW4+2,ROW5+2,ROW6+2,ROW7+2};
 630   1              ClearLine(7);
 631   1              for(i=0;i<MAX_COLOR_TEMP;i++)
 632   1                      {
 633   2                      if(FuncBuf[pCOLORTEMP] == i)
 634   2                              if(MenuPtr.Level == 1)
 635   2                              WriteWordIIC563(0x0cc,fMAGENTA|fBLACK);
 636   2                              else
 637   2                              WriteWordIIC563(0x0cc,fGREEN|fBLACK);
 638   2                      else                    
 639   2                              WriteWordIIC563(0x0cc,fWHITE|fBLACK);
 640   2                      WriteSeqIndexPort(ColorAddr[i],tySRAM_CODE_CC_CD,ColorTab[i],4);
 641   2                      }
 642   1              Offset = UserTab[FuncBuf[pLANGUAGE]];
 643   1              Length = *Offset++;
 644   1              WriteSeqIndexPort(ColorAddr[3],tySRAM_CODE_CC_CD,Offset,Length);
 645   1              ShowStatus(ROW11+2,fGREEN|bBLACK);
 646   1      //      if(MenuPtr.Level ==1&& (FuncBuf[pCOLORTEMP]>2||FuncBuf[pCOLORTEMP]<1) )//change key when first and user
             - item 
 647   1      //              ShowKeyMenu(2,MenuPtr.Level);
 648   1      }
 649          
 650          void ShowTVMenu()
 651          {
 652   1              Byte i;
 653   1              Byte code TV_Menu_Tab[][9]={{"CH SEARCH"},{"CH EDIT  "},{"FINE TUNE"},{"TV INPUT "}};
 654   1              Word code TV_Addr[]={ROW4+2,ROW5+2,ROW6+2,ROW7+2};
 655   1              ClearLine(7);
 656   1      //      FuncBuf[pTVFUNCTION] = 0;
 657   1              for(i=0;i<4;i++)
 658   1                      {
 659   2                      if(FuncBuf[pTVFUNCTION] == i)
 660   2                              if(MenuPtr.Level == 1)
 661   2                              WriteWordIIC563(0x0cc,fMAGENTA|fBLACK);
 662   2                              else
 663   2                              WriteWordIIC563(0x0cc,fGREEN|fBLACK);
 664   2                      else                    
 665   2                              WriteWordIIC563(0x0cc,fWHITE|fBLACK);
 666   2                      WriteSeqIndexPort(TV_Addr[i],tySRAM_CODE_CC_CD,TV_Menu_Tab[i],9);
 667   2                      }
 668   1      }
 669          void ShowRGBMenu()
 670          {
 671   1              //Byte *Offset,i,Length;
 672   1              Word code RGBAddr[4]={ROW8+6,ROW9+6,ROW10+6,ROW11+6};
 673   1      /*
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 12  

 674   1              for(i=1;i<4;i++)
 675   1                      {
 676   1                      if((((i+3) == MenuPtr.Ptr) && (MenuPtr.Level == 2))||((i == MenuPtr.Ptr+1) && (MenuPtr.Level == 1)&& (Me
             -nuPtr.Menu == 2)))
 677   1                              WriteWordIIC563(0x0cc,fMAGENTA|fBLACK);
 678   1                      else                    
 679   1                              WriteWordIIC563(0x0cc,fWHITE|fBLACK);
 680   1                      Offset = Tab_RGB[FuncBuf[pLANGUAGE]*3+(i-1)];
 681   1                      Length = *Offset;
 682   1                      Offset++;
 683   1                      if(MenuPtr.Menu != 2)                   
 684   1                              WriteSeqIndexPort(RGBAddr[i-1],tySRAM_CODE_CC_CD,Offset,Length);
 685   1                      else
 686   1                              WriteSeqIndexPort(RGBAddr[i],tySRAM_CODE_CC_CD,Offset,Length);
 687   1                      }
 688   1      */
 689   1      //      if(MenuPtr.Menu != 2)
 690   1      //      {
 691   1                      switch(MenuPtr.Ptr){
 692   2                              case 4:
 693   2      //                              if((MenuPtr.Ptr == 4) && (MenuPtr.Level == 2)){
 694   2                                              ShowBar(RGBAddr[0]+10,fMAGENTA|fBLACK,FuncMin,FuncMax,FuncBuf[pRCOLOR]);
 695   2                                              ShowValue(RGBAddr[0]+19,fMAGENTA|fBLACK,FuncBuf[pRCOLOR]);              
 696   2      //                              }
 697   2      //                              else{
 698   2      //                                      ShowBar(RGBAddr[0]+10,fWHITE|fBLACK,FuncMin,FuncMax,FuncBuf[pRCOLOR]);
 699   2      //                                      ShowValue(RGBAddr[0]+19,fWHITE|fBLACK,FuncBuf[pRCOLOR]);
 700   2      //                              }
 701   2                              break;
 702   2                              case 5:
 703   2      //                              if((MenuPtr.Ptr == 5) && (MenuPtr.Level == 2)){
 704   2                                              ShowBar(RGBAddr[1]+10,fMAGENTA|fBLACK,FuncMin,FuncMax,FuncBuf[pGCOLOR]);
 705   2                                              ShowValue(RGBAddr[1]+19,fMAGENTA|fBLACK,FuncBuf[pGCOLOR]);
 706   2      //                              }
 707   2      //                              else{
 708   2      //                                      ShowBar(RGBAddr[1]+10,fWHITE|fBLACK,FuncMin,FuncMax,FuncBuf[pGCOLOR]);
 709   2      //                                      ShowValue(RGBAddr[1]+19,fWHITE|fBLACK,FuncBuf[pGCOLOR]);
 710   2      //                              }
 711   2                                      break;
 712   2                              case 6:
 713   2      //                              if((MenuPtr.Ptr == 6) && (MenuPtr.Level == 2)){
 714   2                                              ShowBar(RGBAddr[2]+10,fMAGENTA|fBLACK,FuncMin,FuncMax,FuncBuf[pBCOLOR]);
 715   2                                              ShowValue(RGBAddr[2]+19,fMAGENTA|fBLACK,FuncBuf[pBCOLOR]);
 716   2      //                              }
 717   2      //                              else{
 718   2      //                                      ShowBar(RGBAddr[2]+10,fWHITE|fBLACK,FuncMin,FuncMax,FuncBuf[pBCOLOR]);
 719   2      //                                      ShowValue(RGBAddr[2]+19,fWHITE|fBLACK,FuncBuf[pBCOLOR]);
 720   2      //                              }
 721   2                                      break;
 722   2                      }
 723   1      //              }
 724   1      //      else
 725   1      //      {
 726   1                      //ShowBar(RGBAddr[1]+10,fWHITE|fBLACK,FuncMin,FuncMax,FuncBuf[pRCOLOR]);
 727   1                      //ShowBar(RGBAddr[2]+10,fWHITE|fBLACK,FuncMin,FuncMax,FuncBuf[pGCOLOR]);
 728   1                      //ShowBar(RGBAddr[3]+10,fWHITE|fBLACK,FuncMin,FuncMax,FuncBuf[pBCOLOR]);
 729   1      //              ShowValue(RGBAddr[1]+19,fWHITE|fBLACK,FuncBuf[pRCOLOR]);
 730   1      //              ShowValue(RGBAddr[2]+19,fWHITE|fBLACK,FuncBuf[pGCOLOR]);
 731   1      //              ShowValue(RGBAddr[3]+19,fWHITE|fBLACK,FuncBuf[pBCOLOR]);
 732   1      //      }
 733   1      }
 734          
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 13  

 735          void ClearOSD(void)
 736          {
 737   1      // Clear osd ram
 738   1              WriteWordIIC563(0x0cc,fBLACK|bBLACK|caMIX);
 739   1              WriteIIC563(0x0ce,0x20);
 740   1              WriteIIC563(0x0cf,0x01);
 741   1              // Wait for Clear Ready....
 742   1              LocalTimer = 10;
 743   1              while(((ReadIIC563(0x0cf) & BIT_0) != 0) && LocalTimer != 0){
 744   2                      if(FuncBuf[pVIDEOSOURCE] <cSVIDEO) //jacky20040324
 745   2                              CheckModeChange();
 746   2              }
 747   1              //Sleep(1);
 748   1      }
 749          
 750          void ClearTextArea()
 751          {
 752   1              WriteWordIIC563(0x0cc,fBLACK|fBLACK);
 753   1              WriteSeqIndexPort(ROW4+1,tySRAM_CODE_CC_CD,SPACE,28);
 754   1              WriteSeqIndexPort(ROW5+1,tySRAM_CODE_CC_CD,SPACE,28);
 755   1              WriteSeqIndexPort(ROW6+1,tySRAM_CODE_CC_CD,SPACE,28);
 756   1              WriteSeqIndexPort(ROW7+1,tySRAM_CODE_CC_CD,SPACE,28);
 757   1              WriteSeqIndexPort(ROW8+1,tySRAM_CODE_CC_CD,SPACE,28);
 758   1              WriteSeqIndexPort(ROW9+1,tySRAM_CODE_CC_CD,SPACE,28);
 759   1              WriteSeqIndexPort(ROW10+1,tySRAM_CODE_CC_CD,SPACE,28);
 760   1      }
 761          
 762          void ClearLine(Byte Line)
 763          {
 764   1              WriteWordIIC563(0x0cc,fBLACK|fBLACK);
 765   1              WriteSeqIndexPort(Line*OSD_WIDTH+1,tySRAM_CODE_CC_CD,SPACE,28);
 766   1      }
 767          
 768          void OsdInit(void)
 769          {
 770   1              Byte i;
 771   1              FuncBuf[pTRANSOSD] = Read24C16(ep_Osd_Effect);
 772   1              SetOsdTrans();
 773   1              ClearOSD();
 774   1              ShowOSDFrame(0);
 775   1              WriteIIC563(0x080,0);
 776   1              WriteIIC563(0x090,0x00);  // zooming off
 777   1              WriteIIC563(0x095,0x55);
 778   1              WriteIIC563(0x083,OSD_WIDTH-1);
 779   1              WriteIIC563(0x086,OSD_HIGH-1);
 780   1              WriteIIC563(0x0a2,0);
 781   1              WriteWordIIC563(0x088,ONE_BIT_START_ADDR);
 782   1              WriteWordIIC563(0x08a,TWO_BIT_START_ADDR);
 783   1              WriteWordIIC563(0x08c,FOUR_BIT_START_ADDR);
 784   1              for(i=0;i<13;i++)
 785   1                      WriteWordIndexPort(i,tySRAM_PALETTE,Palette1Bit[i]);
 786   1              for(i=0;i<14*4;i++)
 787   1                      WriteWordIndexPort(i+OFFSET_2BIT,tySRAM_PALETTE,Palette2Bit[i]);
 788   1      //      for(i=0;i<6*16;i++)
 789   1      //              WriteWordIndexPort(i+OFFSET_4BIT,tySRAM_PALETTE,Palette4Bit[i]);
 790   1              WriteSeqIndexPort(0,tySRAM_1BIT,OneBitFont,156*27);
 791   1              WriteSeqIndexPort(0xa0,tySRAM_1BIT,OneBitFont2,48*27);
 792   1              if(FuncBuf[pLANGUAGE]== 5){
 793   2                      WriteSeqIndexPort(0xd0,tySRAM_1BIT,OneBitFontJP,45*27);
 794   2                      WriteSeqIndexPort(0x90,tySRAM_1BIT,OneBitFontJP2,7*27);
 795   2              }
 796   1              else if((FuncBuf[pLANGUAGE] == 7)||(FuncBuf[pLANGUAGE] == 8)){
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 14  

 797   2                      WriteSeqIndexPort(0xd0,tySRAM_1BIT,OneBitFontCH2,48*27);
 798   2                      WriteSeqIndexPort(0x90,tySRAM_1BIT,OneBitFontCH3,6*27);
 799   2              }
 800   1              else
 801   1                      WriteSeqIndexPort(0x90,tySRAM_1BIT,OneBitFontPY,7*27);
 802   1              //WriteSeqIndexPort(0x100,tySRAM_1BIT,OneBitIcon,99*27);
 803   1              WriteSeqIndexPort(0x100,tySRAM_1BIT,OneBitIcon,45*27);
 804   1              WriteSeqIndexPort(0,tySRAM_2BIT,TwoBitFont,15*54);
 805   1              WriteSeqIndexPort(15,tySRAM_2BIT,TwoBitIcon,36*54);
 806   1      //      WriteSeqIndexPort(0,tySRAM_4BIT,FourBitFont,3*6*108);
 807   1              OsdPosition();
 808   1              MenuPtr.Menu = 0;
 809   1              MenuPtr.Level = 0;
 810   1              MenuPtr.Ptr = 0;
 811   1              MenuPtr.Op = 0;
 812   1      }
 813          
 814          void OsdPosition()
 815          {
 816   1      /*      
 817   1              #ifdef X15
 818   1              Word code OSD_PX[]={
 819   1                      64,600,332,64,600
 820   1              };
 821   1              Word code OSD_PY[]={
 822   1                      64,64,249,434,434
 823   1              };
 824   1              Word code OSD_PY1[]={
 825   1                      64,64,330,434,434
 826   1              };
 827   1              #endif
 828   1              #ifdef X17
 829   1              Word code OSD_PX[]={
 830   1                      80,840,460,80,840
 831   1              };
 832   1              Word code OSD_PY[]={
 833   1                      85,85,375,669,669
 834   1              };
 835   1              Word code OSD_PY1[]={
 836   1                      85,85,458,669,669
 837   1              };
 838   1              #endif
 839   1              #ifdef X19
 840   1              Word code OSD_PX[]={
 841   1                      80,840,460,80,840
 842   1              };
 843   1              Word code OSD_PY[]={
 844   1                      85,85,375,669,669
 845   1              };
 846   1              Word code OSD_PY1[]={
 847   1                      85,85,458,669,669
 848   1              };
 849   1              #endif
 850   1              #ifdef X21
 851   1              Word code OSD_PX[]={
 852   1                      99,1129,614,99,1129
 853   1              };
 854   1              Word code OSD_PY[]={
 855   1                      99,99,465,831,831
 856   1              };
 857   1              Word code OSD_PY1[]={
 858   1                      99,99,548,831,831
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 15  

 859   1              };
 860   1              #endif
 861   1      */      
 862   1              Word code OSD_PX[]={
 863   1                      OSD_X1, OSD_X2, OSD_X3, OSD_X1, OSD_X2
 864   1              };
 865   1              Word code OSD_PY[]={
 866   1                      OSD_Y1, OSD_Y1, OSD_Y3, OSD_Y2, OSD_Y2
 867   1              };
 868   1              Word code OSD_PY1[]={
 869   1                      OSD_Y1, OSD_Y1, OSD_Y4, OSD_Y2, OSD_Y2
 870   1              };
 871   1      
 872   1              Word OSD_HPOS,OSD_VPOS;
 873   1              Byte Temp;
 874   1      
 875   1              Temp = ReadIIC563(0x080);
 876   1              WriteIIC563(0x080,(Temp & (~enOSD))); // OSD disable
 877   1              OSD_HPOS = OSD_PX[FuncBuf[pOSDHPOSITION]];
 878   1              if(MenuPtr.Menu == 3)
 879   1                      OSD_VPOS = OSD_PY1[FuncBuf[pOSDHPOSITION]];
 880   1              else
 881   1                      OSD_VPOS = OSD_PY[FuncBuf[pOSDHPOSITION]];
 882   1              if(OSD_HPOS < (PanelWidth-OSD_WIDTH*12))
 883   1                      WriteWordIIC563(0x081,OSD_HPOS);
 884   1              else
 885   1                      WriteWordIIC563(0x081,PanelWidth-OSD_WIDTH*12);
 886   1              if(OSD_VPOS < (PanelHeight-OSD_HIGH*18))
 887   1                      WriteWordIIC563(0x084,OSD_VPOS);
 888   1              else
 889   1                      WriteWordIIC563(0x084,PanelHeight-OSD_HIGH*18);
 890   1      
 891   1              WriteIIC563(0x080,Temp); // OSD enable
 892   1      /*
 893   1              if(FuncBuf[pOSDHPOSITION] < (PanelWidth-OSD_WIDTH*12)/5)
 894   1                      WriteWordIIC563(0x081,FuncBuf[pOSDHPOSITION]*5);
 895   1              else
 896   1                      WriteWordIIC563(0x081,PanelWidth-OSD_WIDTH*12);
 897   1              if(FuncBuf[pOSDVPOSITION] < (PanelHeight-OSD_HIGH*18)/5)
 898   1                      WriteWordIIC563(0x084,FuncBuf[pOSDVPOSITION]*5);
 899   1              else
 900   1                      WriteWordIIC563(0x084,PanelHeight-OSD_HIGH*18);
 901   1      */
 902   1      }
 903          
 904          void Osd_On(Byte Win)
 905          {
 906   1              WriteIIC563(0x080,enOSD|Win);
 907   1              OsdEnable = 1;
 908   1      }
 909          
 910          void Osd_Off(void)
 911          {
 912   1              WriteIIC563(0x080,0);
 913   1              MenuPtr.Menu = 0;
 914   1              MenuPtr.Level = 0;
 915   1              MenuPtr.Ptr = 0;
 916   1              MenuPtr.Op = 0;
 917   1              OsdEnable = 0;
 918   1              OSDZoomFlag = 0;
 919   1      }
 920          
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 16  

 921          void ShowIcon(Byte Ptr)
 922          {
 923   1              Word Addr,Attr;
 924   1              Byte Icon;
 925   1              if((FuncBuf[pVIDEOSOURCE]==cTV)&&(Ptr == 2))
 926   1                      Icon = 7;
 927   1              else
 928   1                      {
 929   2                      Icon = MenuItem[Ptr].Icon;
 930   2      //              printf("Icon=%d\r\n",(Word)Icon);
 931   2              }
 932   1              
 933   1              Addr = MenuItem[Ptr].Address;
 934   1              //if(Icon == 6)///1bit
 935   1              //      {
 936   1              //      Attr = ((Icon-6)*16)<<8;
 937   1                      //Icon = Icon -6;
 938   1              //      WriteWordIIC563(0x0cc,Attr|caFOUR_BIT);
 939   1              //      }
 940   1              //else
 941   1              //      {
 942   1                      Attr = (Icon*4+OFFSET_2BIT+8)<<8;
 943   1              //      }
 944   1      
 945   1              Icon = Icon*6+15;
 946   1              if(MenuPtr.Page == Ptr)
 947   1                      {
 948   2                      if(Icon == 51)///1bit
 949   2                      {
 950   3                              Icon = 0;
 951   3                              WriteWordIIC563(0x0cc,Attr|caONE_BIT_512|caBLINK);
 952   3                      }
 953   2                      else if(Icon == 57){ // 7x6+15 = 57
 954   3                              Icon = 39;
 955   3                                      
 956   3                              WriteWordIIC563(0x0cc,Attr|caONE_BIT_512|caBLINK);
 957   3      
 958   3                      }
 959   2                      else
 960   2                              WriteWordIIC563(0x0cc,Attr|caTWO_BIT|caBLINK);
 961   2                      //WriteWordIIC563(0x0cc,fCYAN|caONE_BIT_512);
 962   2                      //WriteWordIIC563(0x0cc,fCYAN|caTWO_BIT);
 963   2                      }
 964   1              else
 965   1                      {
 966   2                      if(Icon == 51)///1bit
 967   2                      {
 968   3                              Icon = 0;
 969   3                              WriteWordIIC563(0x0cc,Attr|caONE_BIT_512);
 970   3                      }
 971   2                      else if(Icon == 57){ // 7x6+15 = 57
 972   3                              Icon = 39;
 973   3                              WriteWordIIC563(0x0cc,Attr|caONE_BIT_512);
 974   3      
 975   3                      }
 976   2                      else
 977   2                              WriteWordIIC563(0x0cc,Attr|caTWO_BIT);
 978   2                      //WriteWordIIC563(0x0cc,fWHITE|caONE_BIT_512);
 979   2                      //WriteWordIIC563(0x0cc,fWHITE|caTWO_BIT);
 980   2                      }
 981   1              WriteIndexPort(Addr,tySRAM_CODE_CC_CD,Icon);
 982   1              WriteIndexPort(Addr+1,tySRAM_CODE_CC_CD,Icon+1);
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 17  

 983   1              WriteIndexPort(Addr+2,tySRAM_CODE_CC_CD,Icon+2);
 984   1              WriteIndexPort(Addr+ROW1,tySRAM_CODE_CC_CD,Icon+3);
 985   1              WriteIndexPort(Addr+ROW1+1,tySRAM_CODE_CC_CD,Icon+4);
 986   1              WriteIndexPort(Addr+ROW1+2,tySRAM_CODE_CC_CD,Icon+5);
 987   1      }
 988          
 989          void ShowMain(Byte Page)
 990          {
 991   1              //Byte code MaxItemTab[]={MAX_DSUB_ITEM,MAX_DVI_ITEM,MAX_VIDEO_ITEM,MAX_VIDEO_ITEM};
 992   1              Byte i,temp;
 993   1      
 994   1              WriteIIC563(0x080,0); // OSD disable
 995   1              ClearOSD();
 996   1              WriteIIC563(0x090,0x00);  // zooming off
 997   1              ShowOSDFrame(0);
 998   1      //      if(FuncBuf[pVIDEOSOURCE] < 2)
 999   1      //              {
1000   1      //              for(i=0;i<4;i++)
1001   1                              WriteWordIndexPort(i+OFFSET_2BIT,tySRAM_PALETTE,Palette2Bit[i]);
1002   1      //              for(i=0;i<16;i++)
1003   1      //                      WriteWordIndexPort(i+OFFSET_4BIT,tySRAM_PALETTE,Palette4Bit[i]);
1004   1                      WriteSeqIndexPort(0,tySRAM_2BIT,TwoBitFont,15*54);
1005   1      //              WriteSeqIndexPort(0,tySRAM_4BIT,FourBitFont,2*6*108);
1006   1      //              }
1007   1      //      else
1008   1      //              {
1009   1      //              for(i=0;i<4;i++)
1010   1      //                      WriteWordIndexPort(i+OFFSET_2BIT,tySRAM_PALETTE,Palette2Bit[i+4*14]);
1011   1      //              for(i=0;i<16;i++)
1012   1      //                      WriteWordIndexPort(i+OFFSET_4BIT,tySRAM_PALETTE,Palette4Bit[i+16*6]);
1013   1      //              WriteSeqIndexPort(0,tySRAM_2BIT,TwoBitFont+(13*6+7)*54,1*6*54);
1014   1      //              WriteSeqIndexPort(0,tySRAM_4BIT,FourBitFont+5*6*108,1*6*108);   //Hue
1015   1      //              WriteSeqIndexPort(6,tySRAM_4BIT,FourBitFont+1*6*108,1*6*108);   //OSD Trans
1016   1      //              }
1017   1              OsdPosition();
1018   1              OpenWindow(WINDOW4,WIN4_X1,WIN4_X2,WIN4_Y1,WIN4_Y2,WIN4_ATTR,WIN4_COLOR);
1019   1              temp = FuncBuf[pVIDEOSOURCE]; 
1020   1              if(FuncBuf[pVIDEOSOURCE] == cDVI)       //DVI
1021   1                      FuncBuf[pVIDEOSOURCE] = cANALOG;        //DSUB / DVI show same menu
1022   1              //for(i=0;i<MaxItemTab[FuncBuf[pVIDEOSOURCE]];i++)
1023   1              //      ShowIcon(i);
1024   1              RefreshIcon();  
1025   1              FuncBuf[pVIDEOSOURCE] = temp;
1026   1              ShowKeyMenu(Page,MenuPtr.Level);        //first enter page 0 set 
1027   1              ShowSubMenu(Page,0);
1028   1              if(FuncBuf[pVIDEOSOURCE] < cSVIDEO){
1029   2                      ShowResolution(MAINMENU_RES_ADDR,RES_COLOR);
1030   2                      ShowStatus(ROW11+2,fGREEN|bBLACK);
1031   2              }
1032   1              else
1033   1                      ShowTvSystem();
1034   1      }
1035          
1036          void ShowTvSystem()
1037          {
1038   1              Byte code SourceTab1[][7]={" D-SUB ","  DVI  "," YPbPr ","S-Video","Video  ","   TV  "};
1039   1      //      Byte code TvTab[][9]={"PAL 4.43 ","NTSC 4.43"," NTSC N  ","  SECAM  "," UNKNOW  "," SECAM   ","  MONO  
             - ",
1040   1      //                                                " NTSC M  ","PAL 4.43 ","NTSC 4.43","  PAL M  "," NTSC J  "," UNKNOW  ","  MONO   "};
1041   1              WriteWordIIC563(0x0cc,RES_COLOR);
1042   1      //      WriteSeqIndexPort(MAINMENU_RES_ADDR-3,tySRAM_CODE_CC_CD,TvTab[TvMode],9);
1043   1              WriteSeqIndexPort(MAINMENU_RES_ADDR+7,tySRAM_CODE_CC_CD,SourceTab1[FuncBuf[pVIDEOSOURCE]],7);
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 18  

1044   1      }
1045          
1046          void ShowFactMenu()
1047          {
1048   1              Byte i;
1049   1              Byte code FactTab[][7]={{"AdcOft "},{"AdcGain"},{"9300K  "},{"7500K  "},{"6500K  "},{"Cont.  "},{"Brig.  
             -"}};
1050   1              Word code FactAddr[]={ROW5+1,ROW6+1,ROW7+1,ROW8+1,ROW9+1,ROW10+1,ROW11+1};
1051   1              Byte *Offset,Length;//,Win_X1,Win_X2,Win_Y1,Win_Y2;
1052   1      
1053   1              ClearOSD();
1054   1              //ShowOSDFrame(0);
1055   1              WriteIIC563(0x090,0x00);  // zooming off
1056   1              WriteWordIIC563(0x081,OSD_FACT_HPOS);
1057   1              WriteWordIIC563(0x084,OSD_FACT_VPOS);
1058   1              OpenWindow(WINDOW4,WIN4_X1,WIN4_X2,WIN4_Y1,WIN4_Y2,WIN4_ATTR,WIN4_COLOR);
1059   1              //OpenWindow(WINDOW3,WIN3_X1,WIN3_X2,WIN3_Y1,WIN3_Y2,WIN3_ATTR,WIN3_COLOR);
1060   1              ShowVersion();
1061   1              ShowMode(ROW12+1,MODE_COLOR);
1062   1              ShowBackLightTime();
1063   1              for(i=0;i<7;i++)
1064   1              {
1065   2      //              if(i < 3)
1066   2      //                      WriteWordIIC563(0x0cc,fYELLOW|bBLUE);
1067   2      //              else                    
1068   2                      WriteWordIIC563(0x0cc,fWHITE|bBLUE);
1069   2                      WriteSeqIndexPort(FactAddr[i],tySRAM_CODE_CC_CD,FactTab[i],7);
1070   2              }
1071   1              for(i=0;i<MAX_FACT_ITEM;i++)
1072   1              {
1073   2      //              Addr = FactItem[i].Address;
1074   2                      Offset = FactItem[i].Tab;
1075   2                      Length = *Offset;
1076   2                      Offset++;
1077   2                      if(i == MenuPtr.Ptr && MenuPtr.Level == 0)
1078   2                      {
1079   3                              WriteWordIIC563(0x0cc,fYELLOW|bLBLUE);
1080   3                              WriteSeqIndexPort(FactItem[i].Address,tySRAM_CODE_CC_CD,Offset,Length);
1081   3                      }
1082   2                      else
1083   2                      {
1084   3                              WriteWordIIC563(0x0cc,fYELLOW|bBLUE);
1085   3                              WriteSeqIndexPort(FactItem[i].Address,tySRAM_CODE_CC_CD,Offset,Length);
1086   3                      }
1087   2                      if(i > 2 && i != 26){
1088   3                              if(i >= 11 && i <= 19){
1089   4                                      FuncBuf[pCOLORTEMP] = (i - 11)/3;
1090   4                                      LoadColor(FuncBuf[pCOLORTEMP]);
1091   4                              }
1092   3                              else{
1093   4                                      FuncBuf[pCOLORTEMP] = 2;
1094   4                                      LoadColor(FuncBuf[pCOLORTEMP]);
1095   4                              }
1096   3                              FuncPtr = FactItem[i].Index;
1097   3                              GetFuncRange(FuncPtr);
1098   3                              //GetFuncRange(FactItem[i].Index);              
1099   3                              if(i == MenuPtr.Ptr && MenuPtr.Level == 1)
1100   3                              {
1101   4                                      ShowValue(FactItem[i].SelAddr,fYELLOW|bLBLUE,FuncBuf[FactItem[i].Index]);
1102   4                              }
1103   3                              else
1104   3                              {
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 19  

1105   4                                      ShowValue(FactItem[i].SelAddr,fWHITE|bBLUE,FuncBuf[FactItem[i].Index]);
1106   4                              }
1107   3                      }
1108   2              }
1109   1      
1110   1              ShowFactCursor();
1111   1      }
1112          
1113          void ShowFact()
1114          {
1115   1              //Byte *Offset,Length,Win_X1,Win_X2,Win_Y1,Win_Y2;
1116   1              
1117   1              if(MenuPtr.Ptr > 2 && MenuPtr.Level == 1)
1118   1              {
1119   2                      ShowValue(FactItem[MenuPtr.Ptr].SelAddr,fWHITE|bBLUE,FuncBuf[FactItem[MenuPtr.Ptr].Index]);
1120   2              }
1121   1              
1122   1              if(MenuPtr.Op != oDECVAL && MenuPtr.Op != oINCVAL){
1123   2                      ShowFactCursor();
1124   2              }
1125   1      }
1126          void ShowFactCursor()
1127          {
1128   1              Byte *Offset,Length,Win_X1,Win_X2,Win_Y1,Win_Y2;
1129   1              Osd_On(enWIN4);         
1130   1              Offset = FactItem[MenuPtr.Ptr].Tab;
1131   1              Length = *Offset;
1132   1              if(MenuPtr.Level == 1 && MenuPtr.Ptr > 2){
1133   2                      Win_X1 = FactItem[MenuPtr.Ptr].SelAddr % OSD_WIDTH;
1134   2                      Win_X2 = Win_X1 + 2;
1135   2              }
1136   1              else{
1137   2                      Win_X1 = FactItem[MenuPtr.Ptr].Address % OSD_WIDTH;
1138   2                      Win_X2 = Win_X1 + Length - 1;
1139   2              }
1140   1              Win_Y1 = FactItem[MenuPtr.Ptr].SelAddr / OSD_WIDTH;
1141   1              Win_Y2 = FactItem[MenuPtr.Ptr].SelAddr / OSD_WIDTH;
1142   1              OpenWindow(WINDOW3,Win_X1,Win_X2,Win_Y1,Win_Y2,WIN3_ATTR,WIN3_COLOR);
1143   1              Osd_On(enWIN4|enWIN3);  
1144   1      }
1145          void RefreshIcon()
1146          {
1147   1              Byte i,x,y;
1148   1      
1149   1              for(i=0;i<7;i++)
1150   1                      ShowIcon(i);
1151   1              x = MenuItem[MenuPtr.Page].Address % OSD_WIDTH;
1152   1              y = MenuItem[MenuPtr.Page].Address / OSD_WIDTH;
1153   1              Osd_On(enWIN4);
1154   1              OpenWindow(WINDOW2,x,x+2,y,y+1,WIN2_ATTR,SET_ICON_COLOR);
1155   1      
1156   1              Osd_On(enWIN4|enWIN2);
1157   1      }
1158          
1159          void ShowDesc(Byte Ptr,Word Addr,Word Attr)
1160          {
1161   1              Byte *Offset,Length;
1162   1              Offset = DescTab[Ptr][FuncBuf[pLANGUAGE]];
1163   1              Length = *Offset;
1164   1              Offset++;
1165   1              WriteWordIIC563(0x0cc,Attr);
1166   1              WriteSeqIndexPort(Addr,tySRAM_CODE_CC_CD,Offset,Length);
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 20  

1167   1      }
1168          
1169          void ShowDesc_TV(Byte Ptr,Word Addr,Word Attr)
1170          {
1171   1              Byte *Offset,Length;
1172   1              Offset = DescTab_TV[Ptr][FuncBuf[pLANGUAGE]];
1173   1              Length = *Offset;
1174   1              Offset++;
1175   1              WriteWordIIC563(0x0cc,Attr);
1176   1              WriteSeqIndexPort(Addr,tySRAM_CODE_CC_CD,Offset,Length);
1177   1      }
1178          
1179          void ShowDesc_Sound(Byte Ptr,Word Addr,Word Attr)
1180          {
1181   1              Byte *Offset,Length;
1182   1              Offset = DescTab_Sound[Ptr][FuncBuf[pLANGUAGE]];
1183   1              Length = *Offset;
1184   1              Offset++;
1185   1              WriteWordIIC563(0x0cc,Attr);
1186   1              WriteSeqIndexPort(Addr,tySRAM_CODE_CC_CD,Offset,Length);
1187   1      }
1188          
1189          void WriteIndexPort(Word Addr,Byte Type,Byte Ch)
1190          {
1191   1              CheckRegPage(0xe0);
1192   1              IIC_Start();
1193   1              IIC_Tx(SCALER_ADDR);
1194   1              IIC_Tx(0xe0);
1195   1              IIC_Tx(Type);
1196   1              IIC_Tx(Addr&0x00ff);
1197   1              IIC_Tx(Addr>>8);
1198   1              IIC_Tx(Ch);
1199   1              IIC_Stop();
1200   1      }
1201          
1202          void WriteWordIndexPort(Word Addr,Byte Type,Word Ch)
1203          {
1204   1              CheckRegPage(0xe0);
1205   1              IIC_Start();
1206   1              IIC_Tx(SCALER_ADDR);
1207   1              IIC_Tx(0xe0);
1208   1              IIC_Tx(Type);
1209   1              IIC_Tx(Addr&0x00ff);
1210   1              IIC_Tx(Addr>>8);
1211   1              IIC_Tx(Ch&0x00ff);
1212   1              IIC_Tx(Ch>>8);
1213   1              IIC_Stop();
1214   1      }
1215          
1216          void WriteSeqIndexPort(Word Addr,Byte Type,Byte *Ptr,Word Leng)
1217          {
1218   1              Word i;
1219   1              CheckRegPage(0xe0);
1220   1              IIC_Start();
1221   1              IIC_Tx(SCALER_ADDR);
1222   1              IIC_Tx(0xe0);
1223   1              IIC_Tx(Type&(~tyWITH_LANGTH));
1224   1              if(Type & tyWITH_LANGTH)        //if(tyWITH_LENGH) get string length from table 
1225   1                      Leng = *Ptr++;
1226   1              IIC_Tx(Addr&0x00ff);
1227   1              IIC_Tx(Addr>>8);
1228   1              for(i=0; i<Leng; i++)
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 21  

1229   1                      IIC_Tx(*Ptr++);
1230   1              IIC_Stop();
1231   1      }
1232          
1233          void OpenWindow(Byte Win,Byte x1,Byte x2,Byte y1,Byte y2,Byte Attr,Byte Col)
1234          {
1235   1              CheckRegPage(0xe0);
1236   1              IIC_Start();
1237   1              IIC_Tx(SCALER_ADDR);
1238   1              IIC_Tx(0xa5);
1239   1              IIC_Tx(Win);
1240   1              IIC_Tx(x1);
1241   1              IIC_Tx(x2);
1242   1              IIC_Tx(y1);
1243   1              IIC_Tx(y2);
1244   1              if(FuncBuf[pTRANSOSD] != 0 && Win == WINDOW4)
1245   1                      IIC_Tx(Attr|0x10);
1246   1              else
1247   1                      IIC_Tx(Attr);
1248   1              IIC_Tx(Col);
1249   1              IIC_Stop();
1250   1      }
1251          
1252          void BCD(Word Value,Byte *VaSeq,Byte Zero)
1253          {
1254   1              Byte temp,i;
1255   1              for(i=5;i>0;i--)
1256   1                      {
1257   2                      temp = Value % 10;
1258   2                      *(VaSeq+i-1) =  temp+'0';
1259   2                      Value /= 10;
1260   2                      }
1261   1              for(i=0;i<(5-Zero);i++)
1262   1                      {
1263   2                      if(*(VaSeq+i) == '0')
1264   2                              *(VaSeq+i) = ' ';
1265   2                      else
1266   2                              break;
1267   2                      }
1268   1      }
1269          
1270          void ShowValue(Word Addr,Word Attr,Word Value)
1271          {
1272   1              Word Percent;
1273   1              unsigned long temp;
1274   1              Byte Ptr[5];
1275   1      
1276   1              if(MenuPtr.Menu != 2 || FuncPtr == pCONTRAST){
1277   2                      Percent = Value - FuncMin;
1278   2                      temp = Percent * 100;
1279   2              }
1280   1              else{
1281   2                      Percent = Value;
1282   2                      temp = Percent * FuncMax;
1283   2              }
1284   1              
1285   1              Percent = temp / (FuncMax - FuncMin);
1286   1              switch(FuncPtr)
1287   1                      {
1288   2                      case pHPOSITION:
1289   2      // Jacky 0201 removed
1290   2      //              case pOSDVPOSITION:
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 22  

1291   2                              Percent = 100 - Percent;
1292   2                              break;
1293   2                      case pOSDTIMER:
1294   2                              Percent = Value;
1295   2                              temp = Percent * FuncMax;
1296   2                              Percent = temp / (FuncMax - 0);
1297   2                              break;
1298   2                      case pVCMVOL:
1299   2                      case pVIDEOSOURCE:  // channel No display
1300   2                      //case pLIGHTHSTART:
1301   2                      //case pLIGHTHWIDTH:
1302   2                      //case pLIGHTVSTART:
1303   2                      //case pLIGHTVHIGHT:
1304   2                              Percent = Value;
1305   2                              break;
1306   2      //              default:
1307   2      //                      Percent = Value;
1308   2      
1309   2                      };
1310   1              WriteWordIIC563(0x0cc,Attr);
1311   1              BCD(Percent,Ptr,1);
1312   1              WriteSeqIndexPort(Addr,tySRAM_CODE_CC_CD,Ptr+2,3);
1313   1      }
1314          
1315          void ShowBar(Word Addr,Word Attr,Word Min,Word Max,Word Value)
1316          {
1317   1              Byte i,Ptr;
1318   1              Word Percent,temp;
1319   1              unsigned long Wtemp;
1320   1              WriteWordIIC563(0x0cc,Attr);
1321   1              temp = (Value - Min);
1322   1              Wtemp = temp * BAR_LENGTH * BAR_SEGMENT;
1323   1              Percent = Wtemp / (Max-Min);
1324   1              if(Percent > (BAR_LENGTH * BAR_SEGMENT))
1325   1                      Percent = BAR_LENGTH * BAR_SEGMENT;
1326   1              //reverse
1327   1              switch(FuncPtr)
1328   1                      {
1329   2                      case pHPOSITION:
1330   2      // Jacky 0201 removed
1331   2      //              case pOSDVPOSITION:
1332   2                              Percent = (BAR_LENGTH*BAR_SEGMENT) - Percent;
1333   2                              break;
1334   2                      };
1335   1              IIC_Start();
1336   1              IIC_Tx(SCALER_ADDR);
1337   1              IIC_Tx(0xe0);
1338   1              IIC_Tx(tySRAM_CODE_CC_CD);
1339   1              IIC_Tx(Addr&0x00ff);    
1340   1              IIC_Tx(Addr>>8);
1341   1              IIC_Tx(0x19);           //bar '['       Data
1342   1              Ptr = Percent / BAR_SEGMENT;
1343   1              for(i=0;i<Ptr;i++)
1344   1                      temp = IIC_Tx(0x1e);    //bar full icon Data
1345   1              Ptr = Percent % BAR_SEGMENT;
1346   1              //if(Ptr == 6)
1347   1              //      Ptr --;
1348   1              if(Percent<(BAR_LENGTH * BAR_SEGMENT) && Percent>0)
1349   1                      {
1350   2                      IIC_Tx(0x1a+Ptr);       //bar mid icon Data
1351   2                      i++;
1352   2                      }
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 23  

1353   1              for(;i<BAR_LENGTH;i++)
1354   1                      IIC_Tx(0x1a);   //bar empty icon Data
1355   1              IIC_Tx(0x1f);           //bar ']' icon Data
1356   1              IIC_Stop();     
1357   1      }
1358          
1359          /*
1360          void ShowCBar(Word Addr,Word Attr,Word Min,Word Max,Word Value)
1361          {
1362                  Byte i,Ptr;
1363                  Word Percent,temp;
1364                  unsigned long Wtemp;
1365                  WriteWordIIC563(0x0cc,Attr);
1366                  temp = (Value - Min);
1367                  Wtemp = temp * CBAR_LENGTH * CBAR_SEGMENT;
1368                  Percent = Wtemp / (Max-Min);
1369                  if(Percent > (CBAR_LENGTH * CBAR_SEGMENT))
1370                          Percent = CBAR_LENGTH * CBAR_SEGMENT;
1371                  IIC_Start();
1372                  IIC_Tx(SCALER_ADDR);
1373                  IIC_Tx(0xe0);
1374                  IIC_Tx(tySRAM_CODE_CC_CD);
1375                  IIC_Tx(Addr&0x00ff);    
1376                  IIC_Tx(Addr>>8);
1377                  IIC_Tx(0x19);           //bar '['       Data
1378                  Ptr = Percent / CBAR_SEGMENT;
1379                  for(i=0;i<Ptr;i++)
1380                          temp = IIC_Tx(0x1e);    //bar full icon Data
1381                  Ptr = Percent % CBAR_SEGMENT;
1382                  //if(Ptr == 6)
1383                  //      Ptr --;
1384                  if(Percent<(CBAR_LENGTH * CBAR_SEGMENT) && Percent>0)
1385                          {
1386                          IIC_Tx(0x1a+Ptr);       //bar mid icon Data
1387                          i++;
1388                          }
1389                  for(;i<CBAR_LENGTH;i++)
1390                          IIC_Tx(0x1a);   //bar empty icon Data
1391                  IIC_Tx(0x1f);           //bar ']' icon Data
1392                  IIC_Stop();     
1393          }
1394          */
1395          
1396          void ShowDebug(Word Addr,Word Attr,Word Val)            // +jwshin 061019
1397          {
1398   1              Byte VaSeq[5];
1399   1              WriteWordIIC563(0x0cc,Attr);
1400   1              BCD(Val,VaSeq,2);
1401   1              WriteSeqIndexPort(Addr,tySRAM_CODE_CC_CD,VaSeq+1,4);
1402   1              
1403   1      }
1404          
1405          
1406          void ShowResolution(Word Addr,Word Attr)
1407          {
1408   1              Byte VaSeq[5];
1409   1              WriteWordIIC563(0x0cc,Attr);
1410   1              BCD(Hresolution,VaSeq,2);
1411   1              WriteSeqIndexPort(Addr,tySRAM_CODE_CC_CD,VaSeq+1,4);
1412   1              WriteIndexPort(Addr+4,tySRAM_CODE_CC_CD,'x');
1413   1              BCD(Vresolution,VaSeq,2);
1414   1              WriteSeqIndexPort(Addr+5,tySRAM_CODE_CC_CD,VaSeq+1,4);
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 24  

1415   1              WriteIndexPort(Addr+9,tySRAM_CODE_CC_CD,'@');
1416   1              BCD(V_SYNC,VaSeq,2);
1417   1              WriteSeqIndexPort(Addr+10,tySRAM_CODE_CC_CD,VaSeq+2,2);
1418   1      //      WriteIndexPort(Addr+14,tySRAM_CODE_CC_CD,VaSeq[4]);
1419   1              WriteIndexPort(Addr+12,tySRAM_CODE_CC_CD,'H');
1420   1              WriteIndexPort(Addr+13,tySRAM_CODE_CC_CD,'z');
1421   1      }
1422          
1423          void ShowMode(Word Addr,Word Attr)
1424          {
1425   1              Byte VaSeq[5];
1426   1              WriteWordIIC563(0x0cc,Attr);
1427   1              BCD(ModePoint,VaSeq,2);
1428   1              if(ModePoint < UserModeSt)
1429   1                      WriteSeqIndexPort(Addr,tySRAM_CODE_CC_CD,"Preset Mode:",12);
1430   1              else
1431   1                      WriteSeqIndexPort(Addr,tySRAM_CODE_CC_CD,"  User Mode:",12);
1432   1              WriteSeqIndexPort(Addr+12,tySRAM_CODE_CC_CD,VaSeq+3,2);
1433   1      }
1434          
1435          void ShowMessage(Byte No)
1436          {
1437   1              Byte code SourceTab[][7]={"Analog ","DVI    "," YPBPR ","S-Video"};             // +jwshin 061018
1438   1              Byte code MsgIcon[]={0,0,0,6,6,6};
1439   1              Byte code FuncCode[]={pOUTOFRANGE,pNOSIGNAL,pNOSIGNAL,pAUTOADJUST,pAUTOCOLOR ,pEEPROMINIT};
1440   1              WriteIIC563(0x090,0x00);  // zooming off
1441   1              if(No == MSG_OUTRANGE)
1442   1                      ShowOutOfRange();
1443   1              else{
1444   2                      ClearOSD();
1445   2                      WriteWordIIC563(0x081,(PanelWidth-30*12)/2);
1446   2                      WriteWordIIC563(0x084,(PanelHeight-5*18)/2);
1447   2                      OpenWindow(WINDOW4,0,29,0,4,atWIN_SHADOW_4L,bLIGHT>>4);
1448   2                      WriteWordIIC563(0x0cc,fMAGENTA|caONE_BIT_512);
1449   2      
1450   2                      WriteIndexPort(ROW1+3,tySRAM_CODE_CC_CD,MsgIcon[No]);
1451   2                      WriteIndexPort(ROW1+4,tySRAM_CODE_CC_CD,MsgIcon[No]+1);
1452   2                      WriteIndexPort(ROW1+5,tySRAM_CODE_CC_CD,MsgIcon[No]+2);
1453   2                      WriteIndexPort(ROW2+3,tySRAM_CODE_CC_CD,MsgIcon[No]+3);
1454   2                      WriteIndexPort(ROW2+4,tySRAM_CODE_CC_CD,MsgIcon[No]+4);
1455   2                      WriteIndexPort(ROW2+5,tySRAM_CODE_CC_CD,MsgIcon[No]+5);
1456   2                      ShowDesc(FuncCode[No],ROW2+7,fWHITE|bBLACK);
1457   2                      if(No == MSG_NOSYNC) {                                          // +jwshin 061018       
1458   3                              WriteSeqIndexPort(ROW0+12,tySRAM_CODE_CC_CD,SourceTab[FuncBuf[pVIDEOSOURCE]],7);
1459   3                      }
1460   2              }
1461   1              if(No == MSG_OUTRANGE)
1462   1                      ShowStatus(ROW5+2,fWHITE|bBLACK);
1463   1      //      if(No != MSG_NOSYNC)
1464   1      //              if(No != MSG_OUTRANGE)
1465   1      //                      ShowStatus(ROW3+2,fGREEN|bBLACK);
1466   1      //              else
1467   1      //                      ShowStatus(ROW6+2,fWHITE|bBLACK);
1468   1              Osd_On(enWIN4);
1469   1      }
1470          
1471          void ShowOutOfRange()
1472          {
1473   1              Byte i;
1474   1              Byte VaSeq[5];
1475   1              
1476   1              ClearOSD();
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 25  

1477   1              WriteIIC563(0x090,0x00);  // zooming off
1478   1              WriteWordIIC563(0x081,(PanelWidth-30*12)/2);
1479   1              WriteWordIIC563(0x084,(PanelHeight-7*18)/2);
1480   1              OpenWindow(WINDOW4,0,29,0,6,atWIN_SHADOW_4L,bRED>>4);
1481   1              WriteWordIIC563(0x0cc,fWHITE|caONE_BIT_512);
1482   1              
1483   1              for(i=0;i<3;i++){
1484   2                      WriteIndexPort(ROW2+3+i,tySRAM_CODE_CC_CD,i);
1485   2                      WriteIndexPort(ROW3+3+i,tySRAM_CODE_CC_CD,3+i);
1486   2                      //WriteIndexPort(ROW4+3+i,tySRAM_CODE_CC_CD,51+i);
1487   2                      //WriteIndexPort(ROW5+3+i,tySRAM_CODE_CC_CD,57+i);
1488   2              }
1489   1      
1490   1              ShowDesc(pOUTOFRANGE,ROW1+10,fWHITE|bBLACK);
1491   1      
1492   1              WriteWordIIC563(0x0cc,fWHITE|bBLACK);
1493   1              
1494   1              WriteSeqIndexPort(ROW3+12,tySRAM_CODE_CC_CD,"H:",2);
1495   1              BCD(H_SYNC,VaSeq,2);
1496   1              WriteSeqIndexPort(ROW3+14,tySRAM_CODE_CC_CD,VaSeq+1,3);
1497   1              WriteIndexPort(ROW3+17,tySRAM_CODE_CC_CD,'.');
1498   1              WriteIndexPort(ROW3+18,tySRAM_CODE_CC_CD,VaSeq[4]);
1499   1              WriteSeqIndexPort(ROW3+19,tySRAM_CODE_CC_CD,"KHz",3);
1500   1              WriteSeqIndexPort(ROW4+12,tySRAM_CODE_CC_CD,"V:",2);
1501   1              BCD(V_SYNC,VaSeq,2);
1502   1              WriteSeqIndexPort(ROW4+14,tySRAM_CODE_CC_CD,VaSeq+1,3);
1503   1              WriteIndexPort(ROW4+17,tySRAM_CODE_CC_CD,'.');
1504   1              WriteIndexPort(ROW4+18,tySRAM_CODE_CC_CD,VaSeq[4]);
1505   1              WriteSeqIndexPort(ROW4+19,tySRAM_CODE_CC_CD,"Hz",2);
1506   1              WriteSeqIndexPort(ROW5+12,tySRAM_CODE_CC_CD,"Max:",4);
1507   1              BCD(PanelWidth,VaSeq,2);
1508   1              WriteSeqIndexPort(ROW5+16,tySRAM_CODE_CC_CD,VaSeq+1,4);
1509   1              WriteIndexPort(ROW5+20,tySRAM_CODE_CC_CD,'x');
1510   1              BCD(PanelHeight,VaSeq,2);
1511   1              WriteSeqIndexPort(ROW5+21,tySRAM_CODE_CC_CD,VaSeq+1,4);
1512   1      }
1513          /*
1514          void WritePage560(unsigned char addr1,unsigned char addr2,unsigned char *p)
1515          {
1516          unsigned char i,ch;
1517                  IIC_Start();
1518                  IIC_Tx(SCALER_ADDR);
1519                  IIC_Tx(addr1);
1520                  for(i=0; i<16; i++){
1521                          ch = p[addr2 + i];
1522                          IIC_Tx(ch);
1523                  }
1524                  IIC_Stop();
1525          }
1526          */
1527          /*
1528          void ShowSource()
1529          {
1530          
1531                  Byte code SourceTab[][7]={"Analog ","Digital"," CVBS  ","S-Video"};
1532                  ClearOSD();
1533                  WriteWordIIC563(0x081,PanelWidth-8*12);
1534                  WriteWordIIC563(0x084,5);
1535                  WriteWordIIC563(0x0cc,SOURCE_COLOR);
1536                  WriteSeqIndexPort(ROW0,tySRAM_CODE_CC_CD,SourceTab[FuncBuf[pVIDEOSOURCE]],7);
1537                  Osd_On(0);
1538                  OsdTimer = 200;
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 26  

1539          
1540          }
1541          */
1542          
1543          //--------------------- +jwshin 061025   Mute Function Added...
1544          void ShowMuteFuncOnOff()
1545          {
1546   1              if(AudioMute) {
1547   2                      AudioMute = 0;
1548   2              }
1549   1              else {
1550   2                      AudioMute = 1;
1551   2              }
1552   1              SetAudioMute();
1553   1              Write24C16(ep_Status,StatusFlag);
1554   1              WriteIIC563(0x090,0x00);        // zooming off
1555   1              ClearOSD();
1556   1              WriteWordIIC563(0x081,(PanelWidth-30*12));
1557   1              WriteWordIIC563(0x084,(PanelHeight-5*18));
1558   1              WriteWordIIC563(0x0cc,MODE_COLOR);
1559   1              if(AudioMute) {
1560   2                      WriteSeqIndexPort(ROW1+3,tySRAM_CODE_CC_CD,"  Mute On  ",11);
1561   2              }
1562   1              else {
1563   2                      WriteSeqIndexPort(ROW1+3,tySRAM_CODE_CC_CD,"  Mute Off ",11);
1564   2              }
1565   1              Osd_On(0);
1566   1              OsdTimer = 200;
1567   1      }
1568          //----------------------
1569          void ShowMonSel()
1570          {
1571   1              
1572   1              WriteIIC563(0x090,0x00);  // zooming off
1573   1              ClearOSD();
1574   1              WriteWordIIC563(0x081,(PanelWidth-30*12));
1575   1              WriteWordIIC563(0x084,(PanelHeight-5*18));
1576   1              WriteWordIIC563(0x0cc,SOURCE_COLOR);
1577   1              if(MonTogg == 1) {
1578   2                      WriteSeqIndexPort(ROW1+3,tySRAM_CODE_CC_CD,"  Monitor B",11);
1579   2              }
1580   1              else {
1581   2                      WriteSeqIndexPort(ROW1+3,tySRAM_CODE_CC_CD,"  Monitor A",11);
1582   2              }
1583   1              Osd_On(0);
1584   1              OsdTimer = 200;
1585   1      
1586   1      }
1587          // ----------------------------- +jwshin 060908
1588          void ShowRGB_A()
1589          {
1590   1              WriteIIC563(0x090,0x00);  // zooming off
1591   1              ClearOSD();
1592   1              WriteWordIIC563(0x081,(PanelWidth-30*12));
1593   1              WriteWordIIC563(0x084,(PanelHeight-5*18));
1594   1              WriteWordIIC563(0x0cc,SOURCE_COLOR);
1595   1              WriteSeqIndexPort(ROW1+3,tySRAM_CODE_CC_CD,"  RGB A",7);
1596   1              Osd_On(0);
1597   1              OsdTimer = 200;
1598   1      }
1599          
1600          void ShowRGB_B()
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 27  

1601          {
1602   1              WriteIIC563(0x090,0x00);  // zooming off
1603   1              ClearOSD();
1604   1              WriteWordIIC563(0x081,(PanelWidth-30*12));
1605   1              WriteWordIIC563(0x084,(PanelHeight-5*18));
1606   1              WriteWordIIC563(0x0cc,SOURCE_COLOR);
1607   1              WriteSeqIndexPort(ROW1+3,tySRAM_CODE_CC_CD,"  RGB B",7);
1608   1              Osd_On(0);
1609   1              OsdTimer = 200;
1610   1      }
1611          //----------------------------------
1612          void ShowVersion()
1613          {
1614   1              Byte VaSeq[5];
1615   1              WriteWordIIC563(0x0cc,VERSION_COLOR);
1616   1              BCD(Year,VaSeq,4);
1617   1              WriteSeqIndexPort(VERSION_ADDR-1,tySRAM_CODE_CC_CD,VaSeq+1,4);
1618   1              WriteIndexPort(VERSION_ADDR+3,tySRAM_CODE_CC_CD,'/');
1619   1              BCD(Month,VaSeq,2);
1620   1              WriteSeqIndexPort(VERSION_ADDR+4,tySRAM_CODE_CC_CD,VaSeq+3,2);
1621   1              WriteIndexPort(VERSION_ADDR+6,tySRAM_CODE_CC_CD,'/');
1622   1              BCD(Date,VaSeq,2);
1623   1              WriteSeqIndexPort(VERSION_ADDR+7,tySRAM_CODE_CC_CD,VaSeq+3,2);
1624   1      
1625   1              WriteSeqIndexPort(VERSION_ADDR+12,tySRAM_CODE_CC_CD,ModelName,8);
1626   1              WriteIndexPort(VERSION_ADDR+21,tySRAM_CODE_CC_CD,'V');
1627   1              BCD(Version,VaSeq,1);
1628   1              WriteIndexPort(VERSION_ADDR+22,tySRAM_CODE_CC_CD,VaSeq[4]);
1629   1              WriteIndexPort(VERSION_ADDR+23,tySRAM_CODE_CC_CD,'.');
1630   1              BCD(Reversion,VaSeq,2);
1631   1              WriteSeqIndexPort(VERSION_ADDR+24,tySRAM_CODE_CC_CD,VaSeq+3,2);
1632   1      
1633   1      /*      
1634   1              WriteIndexPort(VERSION_ADDR+10,tySRAM_CODE_CC_CD,'V');
1635   1              BCD(Version,VaSeq,1);
1636   1              WriteIndexPort(VERSION_ADDR+11,tySRAM_CODE_CC_CD,VaSeq[4]);
1637   1              WriteIndexPort(VERSION_ADDR+12,tySRAM_CODE_CC_CD,'.');
1638   1              BCD(Reversion,VaSeq,2);
1639   1              WriteSeqIndexPort(VERSION_ADDR+13,tySRAM_CODE_CC_CD,VaSeq+3,2);
1640   1              WriteSeqIndexPort(VERSION_ADDR+16,tySRAM_CODE_CC_CD,ModelName,11);
1641   1      */
1642   1              //WriteSeqIndexPort(VERSION_ADDR+16,tySRAM_CODE_CC_CD,"Build:",6);
1643   1              //BCD(Build,VaSeq,3);
1644   1              //WriteSeqIndexPort(VERSION_ADDR+22,tySRAM_CODE_CC_CD,VaSeq+1,4);
1645   1      
1646   1      }
1647          
1648          void ShowBurnInPattern(bit Init)
1649          {
1650   1              unsigned char temp;
1651   1              
1652   1              VideoMute = 1;
1653   1              if(Init)
1654   1                      {
1655   2                      Osd_Off();
1656   2                      ForceToBackground(0,0,0);
1657   2                      BurnInPattern = 0;
1658   2                      BurnInTimer = 0;
1659   2                      //FastMuteOff();
1660   2                      BackLightOn();
1661   2                      }
1662   1              if(BurnInPattern > 4)
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 28  

1663   1                      BurnInPattern = 0;
1664   1              BurnInTimer = BURN_IN_TIME;
1665   1              temp = ReadIIC563(0x159) & 0xc0;
1666   1              if(BurnInPattern == 0){
1667   2                      WriteIIC563(0x154,0x09);
1668   2                      //temp = temp | BurnInPattern;
1669   2              }
1670   1              else{
1671   2                      WriteIIC563(0x154,0xb1);
1672   2                      temp = temp | ((BurnInPattern-1) & 0x07);
1673   2              }
1674   1              WriteIIC563(0x159,temp);        //RGB
1675   1              BurnInPattern++;
1676   1      }
1677                  
1678          void ShowOSDFrame(Byte Type)
1679          {
1680   1              Byte code LeftLine[]={
1681   1                      0x00,0x08,0x08,0x03,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x0e,0x0d,0x09
1682   1              };
1683   1              Byte code RightLine[]={
1684   1                      0x02,0x08,0x08,0x05,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x07,0x0c,0x0b
1685   1              };
1686   1              Byte code LeftLine2[]={
1687   1                      0x00,0x08,0x08,0x0e,0x0d,0x09
1688   1              };
1689   1              Byte code RightLine2[]={
1690   1                      0x02,0x08,0x08,0x07,0x0c,0x0b
1691   1              };
1692   1              Byte code LeftLine3[]={
1693   1                      0x00,0x08,0x08,0x08,0x09
1694   1              };
1695   1              Byte code RightLine3[]={
1696   1                      0x02,0x08,0x08,0x08,0x0b
1697   1              };
1698   1              Byte code Line0[]={
1699   1                      0x01
1700   1              };
1701   1              Byte code Line3[]={
1702   1                      0x04
1703   1              };
1704   1              Byte code Line12[]={
1705   1                      0x06
1706   1              };
1707   1              Byte code Line14[]={
1708   1                      0x0a
1709   1              };
1710   1              
1711   1              Byte i,End;
1712   1              Word Attr;
1713   1              
1714   1              Attr = OFFSET_2BIT<<8;
1715   1              WriteWordIIC563(0x0cc,Attr|caTWO_BIT);
1716   1              for(i=1; i<30; i++){
1717   2                      WriteIndexPort(ROW0+i,tySRAM_CODE_CC_CD,Line0[0]);
1718   2                      if(Type == 0)
1719   2                              WriteIndexPort(ROW3+i,tySRAM_CODE_CC_CD,Line3[0]);
1720   2                      if(Type != 2){
1721   3                              if(Type == 0)
1722   3                                      WriteIndexPort(ROW12+i,tySRAM_CODE_CC_CD,Line12[0]);
1723   3                              else
1724   3                                      WriteIndexPort(ROW3+i,tySRAM_CODE_CC_CD,Line12[0]);
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 29  

1725   3                      }
1726   2              }
1727   1      
1728   1              if(Type == 2){
1729   2                      WriteSeqIndexPort(9,tySRAM_2BIT,TwoBitFont2,3*54);
1730   2                      WriteSeqIndexPort(0x100,tySRAM_1BIT,OneBitIcon+45*27,6*27);
1731   2                      //Attr = (OFFSET_2BIT+4)<<8;
1732   2                      //WriteWordIIC563(0x0cc,Attr|caTWO_BIT);
1733   2              }
1734   1              else{
1735   2                      WriteSeqIndexPort(9,tySRAM_2BIT,TwoBitFont+9*54,3*54);
1736   2                      WriteSeqIndexPort(0x100,tySRAM_1BIT,OneBitIcon,6*27);
1737   2              }
1738   1              for(i=1; i<30; i++){
1739   2                      if(Type == 0)
1740   2                              WriteIndexPort(ROW14+i,tySRAM_CODE_CC_CD,Line14[0]);
1741   2                      else if(Type == 1)
1742   2                              WriteIndexPort(ROW5+i,tySRAM_CODE_CC_CD,Line14[0]);
1743   2                      else
1744   2                              WriteIndexPort(ROW4+i,tySRAM_CODE_CC_CD,Line14[0]);
1745   2              }
1746   1              
1747   1              switch(Type)
1748   1                      {
1749   2                      case 0:
1750   2                              End = 15;
1751   2                              break;
1752   2                      case 1:
1753   2                              End = 6;
1754   2                              break;
1755   2                      case 2:
1756   2                              End = 5;
1757   2                              break;
1758   2                      };
1759   1              for(i=0; i<End; i++){
1760   2                      if(Type == 0){
1761   3                              WriteIndexPort(OSD_WIDTH*i,tySRAM_CODE_CC_CD,LeftLine[i]);
1762   3                              WriteIndexPort(OSD_WIDTH*i+(OSD_WIDTH-1),tySRAM_CODE_CC_CD,RightLine[i]);
1763   3                      }
1764   2                      else if(Type == 1){
1765   3                              WriteIndexPort(OSD_WIDTH*i,tySRAM_CODE_CC_CD,LeftLine2[i]);
1766   3                              WriteIndexPort(OSD_WIDTH*i+(OSD_WIDTH-1),tySRAM_CODE_CC_CD,RightLine2[i]);
1767   3                      }
1768   2                      else{
1769   3                              WriteIndexPort(OSD_WIDTH*i,tySRAM_CODE_CC_CD,LeftLine3[i]);
1770   3                              WriteIndexPort(OSD_WIDTH*i+(OSD_WIDTH-1),tySRAM_CODE_CC_CD,RightLine3[i]);
1771   3                      }
1772   2              }
1773   1      
1774   1              WriteWordIIC563(0x0cc,Attr|0x0110);
1775   1              if(Type == 0)
1776   1                      WriteSeqIndexPort(ROW13+1,tySRAM_CODE_CC_CD,SPACE,OSD_WIDTH-2);
1777   1              else if(Type == 1)
1778   1                      WriteSeqIndexPort(ROW4+1,tySRAM_CODE_CC_CD,SPACE,OSD_WIDTH-2);
1779   1      
1780   1              
1781   1      /*      
1782   1              Byte code Line1[]={
1783   1                      0x00,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,
1784   1                      0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x02
1785   1              };
1786   1              Byte code LeftLine[]={
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 30  

1787   1                      0x08 //0x03
1788   1              };
1789   1              Byte code RightLine[]={
1790   1                      0x08,0x08,0x05,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x08,0x07,0x0c
1791   1              };
1792   1              Byte code RightLine2[]={
1793   1                      0x08,0x08,0x07,0x0c
1794   1              };
1795   1              Byte code Line2[]={
1796   1                      0x04
1797   1              };
1798   1              Byte code Line3[]={
1799   1                      0x06
1800   1              };
1801   1              Byte code Line4[]={
1802   1                      0x09,0x0a,0x0a,0x0a,0x0a,0x0a,0x0a,0x0a,0x0a,0x0a,0x0a,0x0a,0x0a,0x0a,0x0a,0x0a,
1803   1                      0x0a,0x0a,0x0a,0x0a,0x0a,0x0a,0x0a,0x0a,0x0a,0x0a,0x0a,0x0a,0x0a,0x0b
1804   1              };
1805   1              
1806   1              Byte i,End;
1807   1              Word Attr;
1808   1              
1809   1              Attr = OFFSET_2BIT<<8;
1810   1              WriteWordIIC563(0x0cc,Attr|caTWO_BIT);
1811   1              WriteSeqIndexPort(ROW0,tySRAM_CODE_CC_CD,Line1,30);
1812   1              switch(Type)
1813   1                      {
1814   1                      case 0:
1815   1                              End = 14;
1816   1                              break;
1817   1                      case 1:
1818   1                              End = 5;
1819   1                              break;
1820   1                      };
1821   1              for(i=1; i<End; i++){
1822   1                      WriteIndexPort(OSD_WIDTH*i,tySRAM_CODE_CC_CD,LeftLine[0]);
1823   1                      if(Type == 0)
1824   1                              WriteIndexPort((OSD_WIDTH*(i+1))-1,tySRAM_CODE_CC_CD,RightLine[i-1]);
1825   1                      else if(Type == 1)
1826   1                              WriteIndexPort((OSD_WIDTH*(i+1))-1,tySRAM_CODE_CC_CD,RightLine2[i-1]);
1827   1              }
1828   1              for(i=1; i<29; i++){
1829   1                      if(Type == 0)
1830   1                              WriteIndexPort(ROW3+i,tySRAM_CODE_CC_CD,Line2[0]);
1831   1                      if(Type != 2){
1832   1                              if(Type == 0)
1833   1                                      WriteIndexPort(ROW12+i,tySRAM_CODE_CC_CD,Line3[0]);
1834   1                              else
1835   1                                      WriteIndexPort(ROW3+i,tySRAM_CODE_CC_CD,Line3[0]);
1836   1                      }
1837   1              }
1838   1              if(Type == 0)
1839   1                      WriteSeqIndexPort(ROW14,tySRAM_CODE_CC_CD,Line4,30);
1840   1              else if(Type == 1)
1841   1                      WriteSeqIndexPort(ROW5,tySRAM_CODE_CC_CD,Line4,30);
1842   1              WriteWordIIC563(0x0cc,Attr|0x0110);
1843   1              if(Type == 0)
1844   1                      WriteSeqIndexPort(ROW13+1,tySRAM_CODE_CC_CD,SPACE,28);
1845   1              else if(Type == 1)
1846   1                      WriteSeqIndexPort(ROW4+1,tySRAM_CODE_CC_CD,SPACE,28);
1847   1      */
1848   1      }
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 31  

1849          
1850          // 0x100 ...0x17f ==> TV channel fine tune,PR. NO. TV CH.
1851          // 0x180 ...0x1ff ==> CATV channel fine tune,PR. NO. CATV CH.
1852          // 0x280 ... 0x28f ==>TV channel mask(ADD/DEL),PR. NO. TV channel mask
1853          // 0x290 ... 0x29f ==>CATV channel mask(ADD/DEL),PR. NO. CATV channel mask
1854          
1855          void ShowFineTune(void)
1856          {
1857   1              unsigned char i;
1858   1              Word temp;
1859   1              if((ChSystem==CH_USA)||(ChSystem==CH_JPN))
1860   1                      i = Read24C16(0x209); // ch No
1861   1              else    {
1862   2                      i = Read24C16(0x207);//PR Channel No
1863   2                      if((Read24C16(ep_Input_CH_Sys) &0x80) == 0)
1864   2                              i = Read24C16(0x100+(i - 1));//PR TV CH NO.
1865   2                      else            i = Read24C16(0x180+(i - 1));//PR CATV CH NO.
1866   2              }
1867   1      
1868   1              if((Read24C16(ep_Input_CH_Sys) &0x80) == 0){
1869   2                      i = i - TV_Min;
1870   2                      FuncBuf[pCHFINETUNE] = Read24C16(0x100+i);      
1871   2              }
1872   1              else{
1873   2                      i = i - CATV_Min;
1874   2                      FuncBuf[pCHFINETUNE] = Read24C16(0x180+i);
1875   2              }       
1876   1      
1877   1              if(MenuPtr.Ptr == 2)
1878   1                      temp = BAR_COLOR;
1879   1              else 
1880   1                      temp = FUN_COLOR;
1881   1      
1882   1              ShowBar(MAINMENU_BAR_ADDR+(OSD_WIDTH*2),temp,0,100,FuncBuf[pCHFINETUNE]);
1883   1              ShowValue(MAINMENU_VALUE_ADDR+(OSD_WIDTH*2),temp,FuncBuf[pCHFINETUNE]);
1884   1      }
1885          
1886          
1887          
1888          
1889          void ShowSubMenu(Byte Page, Byte Ptr)
1890          {
1891   1              Byte i,j,FuncPtrTemp;
1892   1              Word Attr;
1893   1      
1894   1              //ClearTextArea();
1895   1              //ShowKeyMenu(Page,MenuPtr.Level);
1896   1              FuncPtrTemp = FuncPtr;
1897   1              if(Page == 0){
1898   2                      for(i=0; i<7; i++){
1899   3                              if(Ptr==i && MenuPtr.Level == 1 )
1900   3                                      Attr = SEL_FUN_COLOR;
1901   3                              else
1902   3                                      Attr = FUN_COLOR;
1903   3                              if(FuncBuf[pVIDEOSOURCE]==cANALOG)
1904   3                                      FuncPtr = Page0Item[i];
1905   3                              else if(FuncBuf[pVIDEOSOURCE]==cDVI)
1906   3                                      FuncPtr = Page0ItemD[i];
1907   3                              else if(FuncBuf[pVIDEOSOURCE]==cYPbPr)
1908   3                                      FuncPtr = Page0ItemY[i];
1909   3                              else
1910   3                                      FuncPtr = Page0ItemV[i];
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 32  

1911   3                              ShowDesc(FuncPtr,MAINMENU_DESC_ADDR+(OSD_WIDTH*i),Attr);
1912   3                              switch(FuncPtr)
1913   3                              {
1914   4                                      case pSHARPNESS:
1915   4                                              GetFuncRange(FuncPtr);
1916   4                                              if(FuncBuf[pVIDEOSOURCE] < cSVIDEO)
1917   4                                                      ShowSharpness();
1918   4                                              else{
1919   5                                                      ShowBar(MAINMENU_BAR_ADDR+(OSD_WIDTH*i),Attr,FuncMin,FuncMax,FuncBuf[FuncPtr]);
1920   5                                                      ShowValue(MAINMENU_VALUE_ADDR+(OSD_WIDTH*i),Attr,FuncBuf[FuncPtr]);
1921   5                                              }
1922   4                                              break;
1923   4                                      default:
1924   4                                              GetFuncRange(FuncPtr);
1925   4                                              ShowBar(MAINMENU_BAR_ADDR+(OSD_WIDTH*i),Attr,FuncMin,FuncMax,FuncBuf[FuncPtr]);
1926   4                                              ShowValue(MAINMENU_VALUE_ADDR+(OSD_WIDTH*i),Attr,FuncBuf[FuncPtr]);
1927   4                                              break;
1928   4                              };
1929   3      
1930   3                              if(FuncBuf[pVIDEOSOURCE] == cDVI && i == 2)
1931   3                                      i = 7;
1932   3                              else if(FuncBuf[pVIDEOSOURCE] >= cYPbPr && i == 4)      // +jwshin 061009
1933   3                                      i = 7;
1934   3                      }
1935   2              }
1936   1              if(Page == 1){
1937   2                      for(i=0; i<4; i++){
1938   3      //              for(i=0; i<2; i++){
1939   3      
1940   3                      
1941   3                              if(Ptr==i && MenuPtr.Level == 1 )
1942   3                                      Attr = SEL_FUN_COLOR;
1943   3                              else
1944   3                                      Attr = FUN_COLOR;
1945   3                              FuncPtr = Page1Item[i];
1946   3                              ShowDesc_Sound(i,MAINMENU_DESC_ADDR+(OSD_WIDTH*i),Attr);
1947   3      //                      ShowDesc(FuncPtr,MAINMENU_DESC_ADDR+(OSD_WIDTH*i),Attr);
1948   3                              switch(FuncPtr)
1949   3                                      {
1950   4                                      case pMUTE:
1951   4                                              ShowOnOff(AudioMute);
1952   4                                              break;
1953   4                                      default:
1954   4                                              GetFuncRange(FuncPtr);
1955   4                                              ShowBar(MAINMENU_BAR_ADDR+(OSD_WIDTH*i),Attr,FuncMin,FuncMax,FuncBuf[FuncPtr]);
1956   4                                              ShowValue(MAINMENU_VALUE_ADDR+(OSD_WIDTH*i),Attr,FuncBuf[FuncPtr]);
1957   4      //                                      printf("FuncBuf[FuncPtr]=%d\r\n",(unsigned short)FuncBuf[FuncPtr]);
1958   4      
1959   4                                              break;
1960   4                                      };
1961   3                              }
1962   2              }
1963   1      
1964   1              if(Page == 2){
1965   2                      if(FuncBuf[pVIDEOSOURCE]==cTV){
1966   3      //                      printf("Ptr=%d,MenuPtr.Level=%d\r\n",(Word)Ptr,(Word)MenuPtr.Level);
1967   3      
1968   3                              ShowTVMenu();
1969   3                              for(i=0; i<4; i++){
1970   4                                      if(Ptr==i && MenuPtr.Level == 1 )
1971   4                                              Attr = SEL_FUN_COLOR;
1972   4                                      else
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 33  

1973   4                                              Attr = FUN_COLOR;
1974   4              
1975   4                                              FuncPtr = Page7Item[i];
1976   4                                      ShowDesc_TV(i,MAINMENU_DESC_ADDR+(OSD_WIDTH*i),Attr);
1977   4                                      switch(FuncPtr)
1978   4                                      {
1979   5                                              case pCHSEARCH:
1980   5                                                      ShowOnOff(0);
1981   5                                                      break;
1982   5                                              case pCHEDIT:
1983   5                                                      ChAdd_Del = CheckChMask();
1984   5                                                      ShowAddDel(ChAdd_Del);
1985   5                                                      break;
1986   5                                              case pCHFINETUNE:
1987   5                                                      GetFuncRange(FuncPtr);
1988   5                                                      ShowFineTune();
1989   5                                                      break;  
1990   5                                              case pINPUT:
1991   5                                                      if((Read24C16(ep_Input_CH_Sys) & 0x80) == 0) j =0;
1992   5                                                      else j = 1;
1993   5      //                                              printf("j=%d\r\n",(Word)j);
1994   5                                                      ShowTV_Input(j);
1995   5      //                                              if(MenuPtr.Level == 2 )
1996   5                                                      break;
1997   5                                      };
1998   4                              }
1999   3      
2000   3                      }
2001   2                      else{
2002   3                              for(i=0; i<7; i++){
2003   4                                      if(Ptr==i && MenuPtr.Level == 1 )
2004   4                                              Attr = SEL_FUN_COLOR;
2005   4                                      else
2006   4                                              Attr = FUN_COLOR;
2007   4              
2008   4                                              FuncPtr = Page2Item[i];
2009   4      //                              ShowDesc(FuncPtr,MAINMENU_DESC_ADDR+(OSD_WIDTH*i),Attr);
2010   4                                      switch(FuncPtr)
2011   4                                      {
2012   5                                              case pCOLORTEMP:
2013   5                                                      ShowColorMenu();
2014   5                                                      break;
2015   5                                              case pRCOLOR:
2016   5                                              case pGCOLOR:
2017   5                                              case pBCOLOR:
2018   5      //                                              if(MenuPtr.Level == 2 )
2019   5                                                      ShowUserRGBMenu();
2020   5                                                      break;
2021   5                                              default:
2022   5                                                      GetFuncRange(FuncPtr);
2023   5                                                      ShowBar(MAINMENU_BAR_ADDR+(OSD_WIDTH*i),Attr,FuncMin,FuncMax,FuncBuf[FuncPtr]);
2024   5                                                      ShowValue(MAINMENU_VALUE_ADDR+(OSD_WIDTH*i),Attr,FuncBuf[FuncPtr]);
2025   5                                                      break;
2026   5                                      };
2027   4                              }
2028   3                      }
2029   2              }
2030   1              if(Page == 3){
2031   2                              ShowLanguage();
2032   2              }
2033   1              if(Page == 4){
2034   2                      if(FuncBuf[pVIDEOSOURCE] > cYPbPr){     
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 34  

2035   3                      for(i=0; i<5; i++){     // for(i=0; i<7; i++){  // +jwshin 050729
2036   4                              if(Ptr==i && MenuPtr.Level == 1 )
2037   4                                      Attr = SEL_FUN_COLOR;
2038   4                              else
2039   4                                      Attr = FUN_COLOR;
2040   4                              
2041   4                              FuncPtr = Page4ItemTV[i];
2042   4                              ShowDesc(FuncPtr,MAINMENU_DESC_ADDR+(OSD_WIDTH*i),Attr);
2043   4                              switch(FuncPtr)
2044   4                                      {
2045   5                                      case pRECALL:
2046   5                                              ShowYesNo(0);
2047   5                                              break;
2048   5                                      case pAUTOSETTING:
2049   5                                              ShowOnOff(AutoSetting);
2050   5                                              break;
2051   5                                      case pOSDHPOSITION:
2052   5                                              GetFuncRange(FuncPtr);
2053   5                                              ShowOSDPosition();
2054   5                                              break;
2055   5                                      case pSCALERMODE:
2056   5      //                                      ShowScalerMode(ScalerMode);
2057   5                                              break;
2058   5      /*                              case pCAPTION:                          // -jwshin 050729
2059   5                                              CaptionFlag= Read24C16(0x7f0);
2060   5                                              ShowOnOff(CaptionFlag);
2061   5                                              break; */
2062   5                                      default:
2063   5                                              GetFuncRange(FuncPtr);
2064   5                                              ShowBar(MAINMENU_BAR_ADDR+(OSD_WIDTH*i),Attr,FuncMin,FuncMax,FuncBuf[FuncPtr]);
2065   5                                              ShowValue(MAINMENU_VALUE_ADDR+(OSD_WIDTH*i),Attr,FuncBuf[FuncPtr]);
2066   5                                              break;
2067   5                                      }
2068   4                              }
2069   3                              }
2070   2                              else{
2071   3                              for(i=0; i<5; i++){             // +jwshin 050729
2072   4                              if(Ptr==i && MenuPtr.Level == 1 )
2073   4                                      Attr = SEL_FUN_COLOR;
2074   4                              else
2075   4                                      Attr = FUN_COLOR;
2076   4                                              FuncPtr = Page4Item[i];
2077   4                              if((FuncPtr==pSCALERMODE)&&(!(ResolutionPtr == 4 ||(ResolutionPtr >= 6 && ResolutionPtr < 13)))){
2078   5                                              Attr=TextUnable;
2079   5                              }
2080   4                              ShowDesc(FuncPtr,MAINMENU_DESC_ADDR+(OSD_WIDTH*i),Attr);
2081   4                              switch(FuncPtr)
2082   4                                      {
2083   5                                      case pRECALL:
2084   5                                              ShowYesNo(0);
2085   5                                              break;
2086   5                                      case pAUTOSETTING:
2087   5                                              ShowOnOff(AutoSetting);
2088   5                                              break;
2089   5                                      case pOSDHPOSITION:
2090   5                                              GetFuncRange(FuncPtr);
2091   5                                              ShowOSDPosition();
2092   5                                              break;
2093   5                                      case pSCALERMODE:
2094   5      //                                      ShowScalerMode(ScalerMode);
2095   5                                              break;
2096   5                                      default:
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 35  

2097   5                                              GetFuncRange(FuncPtr);
2098   5                                              ShowBar(MAINMENU_BAR_ADDR+(OSD_WIDTH*i),Attr,FuncMin,FuncMax,FuncBuf[FuncPtr]);
2099   5                                              ShowValue(MAINMENU_VALUE_ADDR+(OSD_WIDTH*i),Attr,FuncBuf[FuncPtr]);
2100   5                                              break;
2101   5                                      };
2102   4                                      }
2103   3                                      }
2104   2                      }
2105   1              if(Page == 5){
2106   2                      ShowSyncMode();
2107   2              }
2108   1              if(Page == 6){
2109   2                      for(i=0; i<7; i++){
2110   3                              if(Ptr==i && MenuPtr.Level == 1 )
2111   3                                      Attr = SEL_FUN_COLOR;
2112   3                              else
2113   3                                      Attr = FUN_COLOR;
2114   3                              FuncPtr = Page6Item[i];
2115   3                              ShowDesc(FuncPtr,MAINMENU_DESC_ADDR+(OSD_WIDTH*i),Attr);
2116   3                              switch(FuncPtr)
2117   3                              {
2118   4                                      case pLIGHTEN:
2119   4                                              ShowOnOff(LightEn);
2120   4                                              break;
2121   4                                      default:
2122   4                                              GetFuncRange(FuncPtr);
2123   4                                              ShowBar(MAINMENU_BAR_ADDR+(OSD_WIDTH*i),Attr,FuncMin,FuncMax,FuncBuf[FuncPtr]);
2124   4                                              ShowValue(MAINMENU_VALUE_ADDR+(OSD_WIDTH*i),Attr,FuncBuf[FuncPtr]);
2125   4                                              break;
2126   4                              };
2127   3      
2128   3                      }
2129   2              }
2130   1      
2131   1              ShowStatus(ROW11+2,fGREEN|bBLACK);
2132   1              
2133   1              FuncPtr = FuncPtrTemp;
2134   1              
2135   1      }
2136          
2137          void ShowStatus(Word Addr,Word Attr)
2138          {
2139   1      code unsigned char IPSourceIcon[][2]={
2140   1              //0x30,0x31,
2141   1              //0x32,0x33,
2142   1                      12,13,
2143   1                      14,15,
2144   1      };
2145   1      code unsigned char AudioStatusIcon[][2]={
2146   1              //0x34,0x35,
2147   1              //0x36,0x37,
2148   1                      16,17,
2149   1                      18,19,
2150   1      };
2151   1      code unsigned char ColorStatusIcon[][2]={
2152   1              //0x3c,0x3d,
2153   1              //0x3a,0x3b,
2154   1              //0x38,0x39,
2155   1              //0x40,0x41,
2156   1                      24,25,
2157   1                      22,23,
2158   1                      20,21,
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 36  

2159   1                      28,29,
2160   1      };
2161   1      
2162   1      //unsigned char i;
2163   1      
2164   1              WriteWordIIC563(0x0cc,Attr|caONE_BIT_512);
2165   1              if(FuncBuf[pVIDEOSOURCE]==cANALOG)
2166   1                      WriteSeqIndexPort(Addr,tySRAM_CODE_CC_CD,IPSourceIcon[0],2);
2167   1              else if(FuncBuf[pVIDEOSOURCE]==cDVI)
2168   1                      WriteSeqIndexPort(Addr,tySRAM_CODE_CC_CD,IPSourceIcon[1],2);
2169   1      
2170   1              WriteSeqIndexPort(Addr+2,tySRAM_CODE_CC_CD,ColorStatusIcon[FuncBuf[pCOLORTEMP]],2);
2171   1              if(AudioMute)
2172   1                      WriteSeqIndexPort(Addr+4,tySRAM_CODE_CC_CD,AudioStatusIcon[0],2);
2173   1              else
2174   1                      WriteSeqIndexPort(Addr+4,tySRAM_CODE_CC_CD,AudioStatusIcon[1],2);
2175   1      
2176   1      }
2177          void ShowOnOff(Byte Ptr)
2178          {
2179   1      
2180   1      code unsigned char ENG_ON[]={
2181   1              2,"On"
2182   1      };
2183   1      code unsigned char FRA_ON[]={
2184   1              2,"On"
2185   1      };
2186   1      code unsigned char DEU_ON[]={
2187   1              3,"Ein"
2188   1      };
2189   1      code unsigned char ESP_ON[]={
2190   1              4,"Act."
2191   1      };
2192   1      code unsigned char ITA_ON[]={
2193   1              2,"On"
2194   1      };
2195   1      code unsigned char JAP_ON[]={
2196   1              2,"ON"
2197   1      };
2198   1      code unsigned char RSU_ON[]={
2199   1              4,_B,_P00,_P19,_DOT
2200   1      };
2201   1      code unsigned char CHT_ON[]={
2202   1              1,_C55
2203   1      };
2204   1      code unsigned char CHI_ON[]={
2205   1              1,_C1f
2206   1      };
2207   1      
2208   1      code unsigned char ENG_OFF[]={
2209   1              3,"Off"
2210   1      };
2211   1      code unsigned char FRA_OFF[]={
2212   1              3,"Off"
2213   1      };
2214   1      code unsigned char DEU_OFF[]={
2215   1              3,"Aus"
2216   1      };
2217   1      code unsigned char ESP_OFF[]={
2218   1              6,"Desac."
2219   1      };
2220   1      code unsigned char ITA_OFF[]={
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 37  

2221   1              3,"Off"
2222   1      };
2223   1      code unsigned char JAP_OFF[]={
2224   1              3,"OFF"
2225   1      };
2226   1      code unsigned char RSU_OFF[]={
2227   1              5,_B,_P1a,_P00,_P19,_DOT
2228   1      };
2229   1      code unsigned char CHT_OFF[]={
2230   1              1,_C56
2231   1      };
2232   1      code unsigned char CHI_OFF[]={
2233   1              1,_C40
2234   1      };
2235   1      
2236   1      code unsigned char *OnOffTab[][9]={
2237   1              {ENG_OFF,FRA_OFF,DEU_OFF,ESP_OFF,ITA_OFF,JAP_OFF,RSU_OFF,CHT_OFF,CHI_OFF},
2238   1              {ENG_ON,FRA_ON,DEU_ON,ESP_ON,ITA_ON,JAP_ON,RSU_ON,CHT_ON,CHI_ON}
2239   1      };
2240   1              Byte i;
2241   1              Word code OnOffAddr[]={ROW5+17,ROW5+24};
2242   1              Word code CaptionModeAddr[]={ROW10+17,ROW10+24}; //Jason Choi
2243   1              Word code OnOffAddr2[]={ROW7+17,ROW7+24};
2244   1              Word code OnOffAddr3[]={ROW4+17,ROW4+24};
2245   1              Byte *Offset,Length;
2246   1      
2247   1              
2248   1              for(i=0;i<2;i++)
2249   1              {
2250   2                      Offset = OnOffTab[i][FuncBuf[pLANGUAGE]];
2251   2                      Length = *Offset;
2252   2                      Offset++;
2253   2                      if(Ptr == i)
2254   2                              if(((FuncPtr == pMUTE && MenuPtr.Ptr == 1)||(FuncPtr == pAUTOSETTING && MenuPtr.Ptr == 3)||(FuncPtr == 
             -pCHSEARCH&& MenuPtr.Ptr == 0)||(FuncPtr == pCAPTION&&MenuPtr.Ptr == 6)) && MenuPtr.Level == 1)//||(pViolence_R<=FuncPtr>
             -=pDialog_R)
2255   2                                      WriteWordIIC563(0x0cc,fMAGENTA|fBLACK);
2256   2                              else
2257   2                                      WriteWordIIC563(0x0cc,fGREEN|fBLACK);
2258   2                      else
2259   2                              WriteWordIIC563(0x0cc,fWHITE|fBLACK);
2260   2                      if(FuncPtr == pMUTE || FuncPtr == pVOLUME)
2261   2                              WriteSeqIndexPort(OnOffAddr[i],tySRAM_CODE_CC_CD,Offset,Length);
2262   2                      else if(FuncPtr == pAUTOSETTING)
2263   2                              WriteSeqIndexPort(OnOffAddr2[i],tySRAM_CODE_CC_CD,Offset,Length);
2264   2                      else if((FuncPtr == pLIGHTEN)||(FuncPtr == pCHSEARCH))
2265   2                              WriteSeqIndexPort(OnOffAddr3[i],tySRAM_CODE_CC_CD,Offset,Length);
2266   2                      else if(FuncPtr == pCAPTION)
2267   2                              WriteSeqIndexPort(CaptionModeAddr[i],tySRAM_CODE_CC_CD,Offset,Length);
2268   2              }
2269   1      }
2270          
2271          void ShowTV_Input(unsigned char Ptr)
2272          {
2273   1              Byte i;
2274   1              Word code TV_INPUT_Addr[]={ROW7+17,ROW7+24};
2275   1              Byte *Offset,Length;
2276   1      
2277   1      code unsigned char ENG_AIR[]={
2278   1              3,"Air"
2279   1      };
2280   1      code unsigned char ENG_CABLE[]={
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 38  

2281   1              5,"Cable"
2282   1      };
2283   1      code unsigned char *TV_INPUT_Tab[2]={
2284   1              ENG_AIR,ENG_CABLE
2285   1      };
2286   1      //printf("ShowTV_Input\r\n");
2287   1              for(i=0;i<2;i++)
2288   1              {
2289   2                      Offset = TV_INPUT_Tab[i];
2290   2                      Length = *Offset;
2291   2                      Offset++;
2292   2                      if(Ptr == i)
2293   2                              if(MenuPtr.Ptr == 3)
2294   2                                      WriteWordIIC563(0x0cc,fMAGENTA|fBLACK);
2295   2                              else
2296   2                                      WriteWordIIC563(0x0cc,fGREEN|fBLACK);
2297   2                      else
2298   2                              WriteWordIIC563(0x0cc,fWHITE|fBLACK);
2299   2                      if(FuncPtr == pINPUT)
2300   2                              WriteSeqIndexPort(TV_INPUT_Addr[i],tySRAM_CODE_CC_CD,Offset,Length);
2301   2              }
2302   1      }
2303          
2304          void ShowAddDel(unsigned char Ptr)
2305          {
2306   1              Byte i;
2307   1              Word code AddDelAddr[]={ROW5+17,ROW5+24};
2308   1              Byte *Offset;
2309   1      
2310   1      code unsigned char ENG_ADD[]={
2311   1              "Add"
2312   1      };
2313   1      code unsigned char ENG_DEL[]={
2314   1              "Del"
2315   1      };
2316   1      code unsigned char *AddDelTab[2]={
2317   1              ENG_DEL,ENG_ADD
2318   1      };
2319   1      //printf("ShowAddDel\r\n");
2320   1              for(i=0;i<2;i++)
2321   1              {
2322   2                      Offset = AddDelTab[i];
2323   2                      if(Ptr == i)
2324   2                              if(MenuPtr.Ptr == 1)
2325   2                                      WriteWordIIC563(0x0cc,fMAGENTA|fBLACK);
2326   2                              else
2327   2                                      WriteWordIIC563(0x0cc,fGREEN|fBLACK);
2328   2                      else
2329   2                              WriteWordIIC563(0x0cc,fWHITE|fBLACK);
2330   2                      if(FuncPtr == pCHEDIT)
2331   2                              WriteSeqIndexPort(AddDelAddr[i],tySRAM_CODE_CC_CD,Offset,3);
2332   2              }
2333   1      }
2334          
2335          void ShowUserRGBMenu()
2336          {
2337   1              Byte *Offset,i,Length;
2338   1              Word RColor,GColor,BColor;
2339   1              Word code RGBAddr[3]={ROW8+6,ROW9+6,ROW10+6};
2340   1      
2341   1              for(i=4;i<7;i++)
2342   1                      {
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 39  

2343   2                      if((i == (MenuPtr.Ptr)) && (MenuPtr.Level == 2))
2344   2                              WriteWordIIC563(0x0cc,fMAGENTA|fBLACK);
2345   2                      else                    
2346   2                              WriteWordIIC563(0x0cc,fWHITE|fBLACK);
2347   2                      Offset = Tab_RGB[FuncBuf[pLANGUAGE]*3+(i-4)];
2348   2                      Length = *Offset;
2349   2                      Offset++;
2350   2                      WriteSeqIndexPort(RGBAddr[i-4],tySRAM_CODE_CC_CD,Offset,Length);
2351   2                      }
2352   1              //Show user pRCOLOR,pGCOLOR,pBCOLOR
2353   1              if(MenuPtr.Ptr < 4){
2354   2                      RColor = Read24C16(ep_Color4_R);
2355   2                      GColor = Read24C16(ep_Color4_G);
2356   2                      BColor = Read24C16(ep_Color4_B);
2357   2              }
2358   1              else{
2359   2                      RColor = FuncBuf[pRCOLOR];
2360   2                      GColor = FuncBuf[pGCOLOR];
2361   2                      BColor = FuncBuf[pBCOLOR];
2362   2              }
2363   1              GetFuncRange(pRCOLOR);
2364   1              if(MenuPtr.Level == 2){ //change set color on user color
2365   2                      if(MenuPtr.Ptr == 4){
2366   3                              ShowBar(RGBAddr[0]+10,fMAGENTA|fBLACK,FuncMin,FuncMax,RColor);
2367   3                              ShowValue(RGBAddr[0]+19,fMAGENTA|fBLACK,RColor);                
2368   3                              ShowBar(RGBAddr[1]+10,fWHITE|fBLACK,FuncMin,FuncMax,GColor);
2369   3                              ShowValue(RGBAddr[1]+19,fWHITE|fBLACK,GColor);
2370   3                              ShowBar(RGBAddr[2]+10,fWHITE|fBLACK,FuncMin,FuncMax,BColor);
2371   3                              ShowValue(RGBAddr[2]+19,fWHITE|fBLACK,BColor);
2372   3                      }
2373   2                      if(MenuPtr.Ptr == 5){
2374   3                              ShowBar(RGBAddr[0]+10,fWHITE|fBLACK,FuncMin,FuncMax,RColor);
2375   3                              ShowValue(RGBAddr[0]+19,fWHITE|fBLACK,RColor);
2376   3                              ShowBar(RGBAddr[1]+10,fMAGENTA|fBLACK,FuncMin,FuncMax,GColor);
2377   3                              ShowValue(RGBAddr[1]+19,fMAGENTA|fBLACK,GColor);
2378   3                              ShowBar(RGBAddr[2]+10,fWHITE|fBLACK,FuncMin,FuncMax,BColor);
2379   3                              ShowValue(RGBAddr[2]+19,fWHITE|fBLACK,BColor);
2380   3                      }
2381   2                      if(MenuPtr.Ptr == 6){
2382   3                              ShowBar(RGBAddr[0]+10,fWHITE|fBLACK,FuncMin,FuncMax,RColor);
2383   3                              ShowValue(RGBAddr[0]+19,fWHITE|fBLACK,RColor);
2384   3                              ShowBar(RGBAddr[1]+10,fWHITE|fBLACK,FuncMin,FuncMax,GColor);
2385   3                              ShowValue(RGBAddr[1]+19,fWHITE|fBLACK,GColor);
2386   3                              ShowBar(RGBAddr[2]+10,fMAGENTA|fBLACK,FuncMin,FuncMax,BColor);
2387   3                              ShowValue(RGBAddr[2]+19,fMAGENTA|fBLACK,BColor);
2388   3                      }
2389   2                      //ShowKeyMenu(2,MenuPtr.Level);
2390   2              }
2391   1              else{           //the user set white char on color temp 
2392   2                      ShowBar(RGBAddr[0]+10,fWHITE|fBLACK,FuncMin,FuncMax,RColor);
2393   2                      ShowValue(RGBAddr[0]+19,fWHITE|fBLACK,RColor);
2394   2                      ShowBar(RGBAddr[1]+10,fWHITE|fBLACK,FuncMin,FuncMax,GColor);
2395   2                      ShowValue(RGBAddr[1]+19,fWHITE|fBLACK,GColor);
2396   2                      ShowBar(RGBAddr[2]+10,fWHITE|fBLACK,FuncMin,FuncMax,BColor);
2397   2                      ShowValue(RGBAddr[2]+19,fWHITE|fBLACK,BColor);
2398   2              }
2399   1      //      ShowBar(RGBAddr[0]+10,fWHITE|fBLACK,FuncMin,FuncMax,RColor);
2400   1      //      ShowBar(RGBAddr[1]+10,fWHITE|fBLACK,FuncMin,FuncMax,GColor);
2401   1      //      ShowBar(RGBAddr[2]+10,fWHITE|fBLACK,FuncMin,FuncMax,BColor);
2402   1      //      ShowValue(RGBAddr[0]+19,fWHITE|fBLACK,RColor);
2403   1      //      ShowValue(RGBAddr[1]+19,fWHITE|fBLACK,GColor);
2404   1      //      ShowValue(RGBAddr[2]+19,fWHITE|fBLACK,BColor);
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 40  

2405   1                      
2406   1      
2407   1              //ShowKeyMenu(2,MenuPtr.Level);
2408   1      
2409   1      }
2410          
2411          void ShowKeyMenu(Byte Page, Byte Level)
2412          {
2413   1              Byte *Offset,Length;
2414   1              Byte code IncDecIcon[3]={
2415   1              //0x42,0x43,0x44
2416   1              30,31,32
2417   1              };
2418   1              Byte code MenuIcon[3]={
2419   1              //0x45,0x46,0x47
2420   1              33,34,35
2421   1              };
2422   1      //      Byte code KeyStr[][6]={"Enter ","Select","Adjust"};
2423   1      
2424   1              WriteWordIIC563(0x0cc,fBLACK|bGRAY);
2425   1              if((MenuPtr.Menu == 3)||(MenuPtr.Menu == 6)) {
2426   2                      WriteSeqIndexPort(ROW4+1,tySRAM_CODE_CC_CD,SPACE,28);
2427   2              }
2428   1              else {
2429   2                      WriteSeqIndexPort(ROW13+1,tySRAM_CODE_CC_CD,SPACE,28);
2430   2              }
2431   1              
2432   1              WriteWordIIC563(0x0cc,fBLACK|bGRAY|caONE_BIT_512);
2433   1      
2434   1              if((MenuPtr.Menu == 3)||(MenuPtr.Menu == 6)){
2435   2                      WriteSeqIndexPort(ROW4+1,tySRAM_CODE_CC_CD,MenuIcon,3);
2436   2                      WriteSeqIndexPort(ROW4+15,tySRAM_CODE_CC_CD,IncDecIcon,3);
2437   2              }
2438   1              else{
2439   2                      WriteSeqIndexPort(ROW13+1,tySRAM_CODE_CC_CD,MenuIcon,3);
2440   2                      if((Level == 0) ||(Level == 2)||(Page != 2 && Page != 3)||((Page == 2 && FuncBuf[pCOLORTEMP] == 3) ))
2441   2                              WriteSeqIndexPort(ROW13+15,tySRAM_CODE_CC_CD,IncDecIcon,3);
2442   2      //              else 
2443   2      //                      if(Page != 2 && Page != 3)
2444   2      //                              WriteSeqIndexPort(ROW13+18,tySRAM_CODE_CC_CD,IncDecIcon,3);
2445   2      //                      else if((Page == 2 && FuncBuf[pCOLORTEMP] == 3) && (Page != 3))
2446   2      //                              WriteSeqIndexPort(ROW13+18,tySRAM_CODE_CC_CD,IncDecIcon,3);
2447   2              }
2448   1              WriteWordIIC563(0x0cc,fBLACK|bGRAY);
2449   1              if(MenuPtr.Menu == 3){
2450   2                      Offset = KeyStrTab[FuncBuf[pLANGUAGE]*3+2];
2451   2                      Length = *Offset++;
2452   2                      if(MenuPtr.Ptr == 0 ){
2453   3                              ShowDesc(pCONTRAST,ROW4+4,fBLACK|bGRAY);
2454   3                              //WriteSeqIndexPort(ROW4+21,tySRAM_CODE_CC_CD,KeyStr[2],6);
2455   3                      }
2456   2                      else if(MenuPtr.Ptr == 1 ){
2457   3                              ShowDesc(pBACKLIGHT,ROW4+4,fBLACK|bGRAY);
2458   3                              //WriteSeqIndexPort(ROW4+21,tySRAM_CODE_CC_CD,KeyStr[2],6);
2459   3                      }
2460   2                      WriteSeqIndexPort(ROW4+18,tySRAM_CODE_CC_CD,Offset,Length);
2461   2              }               
2462   1      //------------------------      
2463   1              else if(MenuPtr.Menu == 6) {                    // +jwshin 050802
2464   2                      Offset = KeyStrTab[FuncBuf[pLANGUAGE]*3+2];
2465   2                      Length = *Offset++;
2466   2                      ShowDesc(pVOLUME,ROW4+4,fBLACK|bGRAY);
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 41  

2467   2                      WriteSeqIndexPort(ROW4+18,tySRAM_CODE_CC_CD,Offset,Length);
2468   2              }
2469   1      //------------------------      
2470   1              else
2471   1              {
2472   2                      if(Level == 0 )
2473   2                      {
2474   3                              Offset = KeyStrTab[FuncBuf[pLANGUAGE]*3];
2475   3                              Length = *Offset++;
2476   3                              WriteSeqIndexPort(ROW13+4,tySRAM_CODE_CC_CD,Offset,Length);
2477   3                              //WriteSeqIndexPort(ROW13+4,tySRAM_CODE_CC_CD,KeyStr[0],6);
2478   3                              Offset = KeyStrTab[FuncBuf[pLANGUAGE]*3+1];
2479   3                              Length = *Offset++;
2480   3                              WriteSeqIndexPort(ROW13+18,tySRAM_CODE_CC_CD,Offset,Length);
2481   3                              //WriteSeqIndexPort(ROW13+18,tySRAM_CODE_CC_CD,KeyStr[1],6);
2482   3                      }
2483   2                      else if(Level == 1)
2484   2                      {
2485   3                              if((Page == 0) || (Page == 1) || (Page == 4) || (Page == 6)){
2486   4                                      Offset = KeyStrTab[FuncBuf[pLANGUAGE]*3+1];
2487   4                                      Length = *Offset++;
2488   4                                      WriteSeqIndexPort(ROW13+4,tySRAM_CODE_CC_CD,Offset,Length);
2489   4                                      Offset = KeyStrTab[FuncBuf[pLANGUAGE]*3+2];
2490   4                                      Length = *Offset++;
2491   4                                      WriteSeqIndexPort(ROW13+18,tySRAM_CODE_CC_CD,Offset,Length);
2492   4                              }
2493   3                              else if(Page == 5){
2494   4                                      Offset = KeyStrTab[FuncBuf[pLANGUAGE]*3+1];
2495   4                                      Length = *Offset++;
2496   4                                      WriteSeqIndexPort(ROW13+4,tySRAM_CODE_CC_CD,Offset,Length);
2497   4                                      Offset = KeyStrTab[FuncBuf[pLANGUAGE]*3];
2498   4                                      Length = *Offset++;
2499   4                                      WriteSeqIndexPort(ROW13+18,tySRAM_CODE_CC_CD,Offset,Length);
2500   4                              }
2501   3                              else{
2502   4                                      Offset = KeyStrTab[FuncBuf[pLANGUAGE]*3+1];
2503   4                                      Length = *Offset++;
2504   4                                      WriteSeqIndexPort(ROW13+4,tySRAM_CODE_CC_CD,Offset,Length);
2505   4                                      if(Page == 2 && FuncBuf[pCOLORTEMP] == 3){
2506   5                                              Offset = KeyStrTab[FuncBuf[pLANGUAGE]*3];
2507   5                                              Length = *Offset++;
2508   5                                              WriteSeqIndexPort(ROW13+18,tySRAM_CODE_CC_CD,Offset,Length);
2509   5                                      }
2510   4                              }
2511   3                      }
2512   2                      else
2513   2                      {
2514   3                              Offset = KeyStrTab[FuncBuf[pLANGUAGE]*3+1];
2515   3                              Length = *Offset++;
2516   3                              WriteSeqIndexPort(ROW13+4,tySRAM_CODE_CC_CD,Offset,Length);
2517   3                              Offset = KeyStrTab[FuncBuf[pLANGUAGE]*3+2];
2518   3                              Length = *Offset++;
2519   3                              WriteSeqIndexPort(ROW13+18,tySRAM_CODE_CC_CD,Offset,Length);
2520   3                      }
2521   2              }
2522   1      }
2523          
2524          void ShowOSDPosition()
2525          {
2526   1      code unsigned char OSDPos1Str[]={
2527   1              1,"1"
2528   1      };
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 42  

2529   1      code unsigned char OSDPos2Str[]={
2530   1              1,"2"
2531   1      };
2532   1      code unsigned char OSDPos3Str[]={
2533   1              1,"3"
2534   1      };
2535   1      code unsigned char OSDPos4Str[]={
2536   1              1,"4"
2537   1      };
2538   1      code unsigned char OSDPos5Str[]={
2539   1              1,"5"
2540   1      };
2541   1              Byte code *OSDPosTab[]={
2542   1              OSDPos1Str,OSDPos2Str,OSDPos3Str,OSDPos4Str,OSDPos5Str
2543   1      };
2544   1      
2545   1              Word code OSDPosAddr[5]={ROW5+17,ROW5+19,ROW5+21,ROW5+23,ROW5+25};
2546   1              Byte *Offset,i,Length;
2547   1      
2548   1              for(i=0;i<5;i++)
2549   1                      {
2550   2                      if(FuncBuf[pOSDHPOSITION] == i)
2551   2                              if(MenuPtr.Ptr == 1 && MenuPtr.Level == 1)
2552   2                                      WriteWordIIC563(0x0cc,fMAGENTA|fBLACK);
2553   2                              else
2554   2                                      WriteWordIIC563(0x0cc,fGREEN|fBLACK);
2555   2                      else                    
2556   2                              WriteWordIIC563(0x0cc,fWHITE|fBLACK);
2557   2                      Offset = OSDPosTab[i];
2558   2                      Length = *Offset;
2559   2                      Offset++;
2560   2                      WriteSeqIndexPort(OSDPosAddr[i],tySRAM_CODE_CC_CD,Offset,Length);
2561   2                      }
2562   1      }
2563          void ShowBrightnessMenu()
2564          {
2565   1              WriteIIC563(0x080,0); // OSD disable
2566   1              ClearOSD();
2567   1              WriteIIC563(0x090,0x00);  // zooming off
2568   1              ShowOSDFrame(1);
2569   1              OsdPosition();
2570   1              OpenWindow(WINDOW4,WIN4_X1,WIN4_X2,WIN4_Y1,WIN4_Y2-9,WIN4_ATTR,WIN4_COLOR);
2571   1              OpenWindow(WINDOW3,WIN3_X1,WIN3_X2,WIN3_Y1,WIN3_Y2,WIN3_ATTR,WIN3_COLOR);
2572   1              if(FuncBuf[pVIDEOSOURCE] < cSVIDEO){
2573   2                      //ShowResolution(HOTKEYMENU_RES_ADDR,RES_COLOR);
2574   2                      ShowStatus(ROW2+2,fGREEN|bBLACK);
2575   2              }
2576   1              //else
2577   1              //      ShowTvSystem();
2578   1              ShowKeyMenu(0,MenuPtr.Level);
2579   1              
2580   1              FuncPtr = Page0Item[MenuPtr.Ptr];
2581   1              ShowDesc(FuncPtr,HOTKEYMENU_DESC_ADDR,SEL_FUN_COLOR);
2582   1              GetFuncRange(FuncPtr);
2583   1              ShowBar(HOTKEYMENU_BAR_ADDR,SEL_FUN_COLOR,FuncMin,FuncMax,FuncBuf[FuncPtr]);
2584   1              ShowValue(HOTKEYMENU_VALUE_ADDR,SEL_FUN_COLOR,FuncBuf[FuncPtr]);
2585   1      }
2586          void ShowSharpness()
2587          {
2588   1      code unsigned char Sharp1Str[]={
2589   1              1,"1"
2590   1      };
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 43  

2591   1      code unsigned char  Sharp2Str[]={
2592   1              1,"2"
2593   1      };
2594   1      code unsigned char  Sharp3Str[]={
2595   1              1,"3"
2596   1      };
2597   1      code unsigned char  Sharp4Str[]={
2598   1              1,"4"
2599   1      };
2600   1      code unsigned char  Sharp5Str[]={
2601   1              1,"5"
2602   1      };
2603   1              Byte code * SharpTab[]={
2604   1               Sharp1Str, Sharp2Str, Sharp3Str, Sharp4Str, Sharp5Str
2605   1      };
2606   1      
2607   1              Word code  SharpAddr[5]={17,19,21,23,25};
2608   1              //Word code  SharpAddr_D[5]={ROW6+17,ROW6+19,ROW6+21,ROW6+23,ROW6+25};
2609   1              //Word code  SharpAddr_V[5]={ROW8+17,ROW8+19,ROW8+21,ROW8+23,ROW8+25};
2610   1              Byte *Offset,i,Length;
2611   1      
2612   1              for(i=0;i<5;i++)
2613   1              {
2614   2                      if(FuncBuf[pSHARPNESS] == i)
2615   2                              if((MenuPtr.Ptr == 6 && MenuPtr.Level == 1)||
2616   2                                      (SyncMode == 3 && MenuPtr.Ptr == 2 && MenuPtr.Level == 1)||
2617   2                                      (FuncBuf[pVIDEOSOURCE]>cYPbPr&& MenuPtr.Ptr == 4 && MenuPtr.Level == 1))
2618   2                                      WriteWordIIC563(0x0cc,fMAGENTA|fBLACK);
2619   2                              else
2620   2                                      WriteWordIIC563(0x0cc,fGREEN|fBLACK);
2621   2                      else
2622   2                              WriteWordIIC563(0x0cc,fWHITE|fBLACK);
2623   2                              
2624   2                      Offset = SharpTab[i];
2625   2                      Length = *Offset;
2626   2                      Offset++;
2627   2                      if(FuncBuf[pVIDEOSOURCE]==cANALOG)//for DVI = 0
2628   2                              WriteSeqIndexPort( ROW10+SharpAddr[i],tySRAM_CODE_CC_CD,Offset,Length);
2629   2                      else if(FuncBuf[pVIDEOSOURCE]==cDVI)
2630   2                              WriteSeqIndexPort( ROW6+SharpAddr[i],tySRAM_CODE_CC_CD,Offset,Length);
2631   2                      else if(FuncBuf[pVIDEOSOURCE]==cYPbPr)
2632   2                              WriteSeqIndexPort( ROW8+SharpAddr[i],tySRAM_CODE_CC_CD,Offset,Length);
2633   2                      else
2634   2                              WriteSeqIndexPort( ROW8+SharpAddr[i],tySRAM_CODE_CC_CD,Offset,Length);
2635   2              }
2636   1      }
2637          
2638          void ShowTurboModeMenu()
2639          {
2640   1              Byte i;
2641   1              //Byte *Offset,Length;
2642   1      
2643   1              WriteIIC563(0x080,0); // OSD disable
2644   1              ClearOSD();
2645   1              WriteIIC563(0x090,0x00);  // zooming off
2646   1              ShowOSDFrame(2);
2647   1      //      OsdPosition();
2648   1              WriteWordIIC563(0x081,460);
2649   1              WriteWordIIC563(0x084,467);
2650   1              OpenWindow(WINDOW4,WIN4_X1,WIN4_X2,WIN4_Y1,WIN4_Y2-8,WIN4_ATTR,WIN4_COLOR);
2651   1              OpenWindow(WINDOW3,WIN3_X1,WIN3_X2,WIN3_Y1,WIN3_Y2,WIN3_ATTR,WIN3_COLOR);
2652   1      
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 44  

2653   1              WriteWordIIC563(0x0cc,fMAGENTA|caONE_BIT_512);
2654   1              for(i=0;i<3;i++){
2655   2                      WriteIndexPort(ROW1+3+i,tySRAM_CODE_CC_CD,i);
2656   2                      WriteIndexPort(ROW2+3+i,tySRAM_CODE_CC_CD,3+i);
2657   2              }
2658   1              ShowTurboMode();
2659   1              ShowStatus(ROW3+2,fGREEN|bBLACK);
2660   1      }
2661          
2662          void ShowTurboMode()
2663          {
2664   1              Byte *Offset,Length;
2665   1              Word temp;
2666   1      
2667   1              
2668   1              //show description
2669   1              WriteWordIIC563(0x0cc,fWHITE|bBLACK);
2670   1              WriteSeqIndexPort(ROW2+8,tySRAM_CODE_CC_CD,SPACE,20);
2671   1              
2672   1              if(!TextMode && !EconomyMode)
2673   1                      temp = FuncBuf[pLANGUAGE]*3+0;
2674   1                      //Offset = TurboStrTab[FuncBuf[pLANGUAGE]*3+0];
2675   1              else if(TextMode && !EconomyMode)
2676   1                      temp = FuncBuf[pLANGUAGE]*3+1;
2677   1                      //Offset = TurboStrTab[FuncBuf[pLANGUAGE]*3+1];
2678   1              else
2679   1                      temp = FuncBuf[pLANGUAGE]*3+2;
2680   1                      //Offset = TurboStrTab[FuncBuf[pLANGUAGE]*3+2];
2681   1              Offset = TurboStrTab[temp];
2682   1              Length = *Offset++;
2683   1              WriteSeqIndexPort(ROW2+7,tySRAM_CODE_CC_CD,Offset,Length);
2684   1      }
2685          
2686          void ShowBackLightTime()
2687          {
2688   1              Byte VaSeq[5],Minute,Second;
2689   1              unsigned long Hour;
2690   1      
2691   1              Second = (Byte)(BackLightTimer % 60);
2692   1              Minute = (Byte) ((BackLightTimer / 60) % 60);
2693   1              //Hour = BackLightTimer / 3600;
2694   1              
2695   1              WriteWordIIC563(0x0cc,fGREEN|bBLACK);
2696   1              Hour = BackLightTimer /3600 / 10000;
2697   1              BCD(Hour,VaSeq,5);
2698   1              WriteSeqIndexPort(BACKLIGHTTIME_ADDR,tySRAM_CODE_CC_CD,VaSeq+4,1);
2699   1              Hour = (BackLightTimer /3600) % 10000;
2700   1              BCD(Hour,VaSeq,5);
2701   1              WriteSeqIndexPort(BACKLIGHTTIME_ADDR+1,tySRAM_CODE_CC_CD,VaSeq+1,4);
2702   1              WriteIndexPort(BACKLIGHTTIME_ADDR+5,tySRAM_CODE_CC_CD,':');
2703   1              BCD(Minute,VaSeq,2);
2704   1              WriteSeqIndexPort(BACKLIGHTTIME_ADDR+6,tySRAM_CODE_CC_CD,VaSeq+3,2);
2705   1      
2706   1              WriteSeqIndexPort(BACKLIGHTTIME_ADDR-4,tySRAM_CODE_CC_CD,"B/L",3);
2707   1              //WriteIndexPort(BACKLIGHTTIME_ADDR-4,tySRAM_CODE_CC_CD,'B');
2708   1              //WriteIndexPort(BACKLIGHTTIME_ADDR-3,tySRAM_CODE_CC_CD,OSD_index_general+11);//"/"
2709   1              //WriteIndexPort(BACKLIGHTTIME_ADDR-2,tySRAM_CODE_CC_CD,'L');
2710   1      #if 0   
                      WriteIndexPort(ACKLIGHTTIME_ADDR+7,tySRAM_CODE_CC_CD,':');
                      BCD(Second,VaSeq,2);
                      WriteSeqIndexPort(ACKLIGHTTIME_ADDR+8,tySRAM_CODE_CC_CD,VaSeq+3,2);
                      Hour = BackLightTimer / 10000;
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 45  

                      BCD(Hour,VaSeq,5);
                      WriteSeqIndexPort(ROW1+19,tySRAM_CODE_CC_CD,VaSeq,5);
                      Hour = BackLightTimer % 10000;
                      BCD(Hour,VaSeq,4);
                      WriteSeqIndexPort(ROW1+24,tySRAM_CODE_CC_CD,VaSeq+1,4);
              #endif  
2721   1      }
2722          
2723          void ShowScalerMode(Byte Ptr)
2724          {
2725   1      code unsigned char ENG_43[]={
2726   1              3,"4:3"
2727   1      };
2728   1      code unsigned char ENG_54[]={
2729   1              3,"5:4"
2730   1      };
2731   1      
2732   1      
2733   1      code unsigned char *ScalerModeTab[]={
2734   1              ENG_43,ENG_54,
2735   1      };
2736   1              Byte i;
2737   1              Word code ScalerModeAddr[]={ROW9+17,ROW9+24};
2738   1              Byte *Offset,Length;
2739   1      
2740   1      //      if(!(ResolutionPtr == 4 ||(ResolutionPtr >= 6 && ResolutionPtr < 13))) Ptr = 1; // make 5:4  
2741   1              
2742   1              for(i=0;i<2;i++)
2743   1              {
2744   2                      Offset = ScalerModeTab[i];
2745   2                      Length = *Offset;
2746   2                      Offset++;
2747   2                      if(Ptr == i)
2748   2                              if(((FuncPtr == pSCALERMODE && MenuPtr.Ptr == 5)) && MenuPtr.Level == 1)
2749   2                                      WriteWordIIC563(0x0cc,fMAGENTA|fBLACK);
2750   2                              else
2751   2                                      WriteWordIIC563(0x0cc,fGREEN|fBLACK);
2752   2                      else{
2753   3                              if(ResolutionPtr == 4 ||(ResolutionPtr >= 6 && ResolutionPtr < 13))
2754   3                                      WriteWordIIC563(0x0cc,fWHITE|fBLACK);
2755   3                              else
2756   3                                      WriteWordIIC563(0x0cc,TextUnable);
2757   3      
2758   3                      }
2759   2                      WriteSeqIndexPort(ScalerModeAddr[i],tySRAM_CODE_CC_CD,Offset,Length);
2760   2              }
2761   1      }
2762          
2763          void DisplaySource(unsigned char i)
2764                  //Souce Select source 
2765                  
2766          {
2767   1      //      Byte VaSeq[5];
2768   1      //      printf("DisplaySource\r\n");
2769   1      //      OSD_Type = oCHANNEL;
2770   1              ClearOSD();
2771   1              WriteWordIIC563(0x081,OSD3_Px);
2772   1              WriteWordIIC563(0x084,0);
2773   1              OpenWindow(WINDOW1,0,29,0,4,atWIN_TRANSLUCENT,ChannelColor);
2774   1      
2775   1      //              ShowDesc(pVIDEOSOURCE,ROW1+10,clGREEN|bBLACK);
2776   1      //      ShowDesc(pVIDEOSOURCE,ROW0,clGREEN);
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 46  

2777   1              WriteIIC563(0x090,0x03);  // OSD zooming on
2778   1              WriteIIC563(0x095,0xFF); // OSD Font Zoowing On
2779   1              WriteIIC563(0xC2,0x1); // 0 Row Border enable 
2780   1              WriteWordIIC563(0xcc,ChannelColor);
2781   1              
2782   1              if(i==cANALOG){  //pc
2783   2                      WriteSeqIndexPort(ROW0+2,tySRAM_CODE_CC_CD,"  Analog",8);
2784   2                      }
2785   1              else if(i==cDVI){//PC-dvi
2786   2                      WriteSeqIndexPort(ROW0+2,tySRAM_CODE_CC_CD,"     DVI",8);
2787   2                      }
2788   1              else if(i==cYPbPr){//YPbPr
2789   2                      WriteSeqIndexPort(ROW0+2,tySRAM_CODE_CC_CD,"   YPbPr",8);
2790   2                      }
2791   1              else if(i==cSVIDEO){//S-Video 
2792   2                      WriteSeqIndexPort(ROW0+1,tySRAM_CODE_CC_CD,"  S-Video",9);
2793   2                      }
2794   1              else if(i==cCOMPOSIT){ //video
2795   2                      WriteSeqIndexPort(ROW0+2,tySRAM_CODE_CC_CD,"   Video",8);
2796   2                      }
2797   1              else if(i==cTV){ //TV
2798   2                      ShowSource_Video(); //TV Select TV Channel 
2799   2      //              printf("ChBuffer=%d from h\r\n",(unsigned short)ChBuffer);
2800   2                      FuncPtr = pVIDEOSOURCE;
2801   2                      ShowValue(ROW0+7, ChannelColor, ChBuffer);
2802   2                      }
2803   1              
2804   1              
2805   1              Osd_On(enOSD); //OSD ON
2806   1              OsdTimer = 500;
2807   1              OSDZoomFlag = 1;
2808   1      
2809   1      //      printf("OsdTimer=%d\r\n",(unsigned short)OsdTimer);
2810   1      //      WriteIIC563(0x090,0x00);  // zooming on
2811   1              }
2812          
2813          void ShowSource_Video(void)
2814          {
2815   1      //      Byte VaSeq[5];
2816   1              ClearOSD();
2817   1              WriteWordIIC563(0xcc,ChannelColor);
2818   1              if((Read24C16(0x208) & 0x80) == 0)
2819   1                      WriteSeqIndexPort(ROW0+3,tySRAM_CODE_CC_CD,"  CH",4);
2820   1              else             
2821   1                      WriteSeqIndexPort(ROW0+3,tySRAM_CODE_CC_CD,"CATV",4);
2822   1      }
2823          
2824          void DisplayCaption(unsigned char i) //EEPROM   
2825          {
2826   1              if(i==0){
2827   2                      if(i!=Read24C16(0x7f0)){
2828   3                      Write24C16(0x7f0,0x00);}
2829   2                      Z86229_Init();
2830   2                      }
2831   1              else if(i==1){
2832   2                      if(i!=Read24C16(0x7f0)){
2833   3                      Write24C16(0x7f0,0x01);}
2834   2                      Z86229_Init();
2835   2                      }
2836   1      }
2837          /*
2838          void InitEDID_Save(void)
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 47  

2839          {
2840                  Byte xdata *DDCptr;
2841                  Byte i;
2842                  DDC_CTL0 = 0;           //disable DDC
2843                  DDC_CTL1 = 0;           //disable DDC
2844                  DDCptr = 0xf800;  
2845                  for(i=0;i<128;i++)
2846                          {
2847                          CLRWDT = 0x55;
2848                          *DDCptr++ = DVI_EDID[i];
2849                          }
2850                  DDC_CTL0 = (EN_DDC|CLR_UPD|CLR_PTR);    
2851                  DDC_CTL1 = (EN_DDC|CLR_UPD|CLR_PTR);    
2852                  SaveDDCData(0);
2853          
2854          }
2855          */
2856          
2857          void    ChannelMove(unsigned char No)
2858          {
2859   1              if(IR_Number_cnt == 1){
2860   2                              IR_Number = No;
2861   2                              WriteWordIIC563(0x081,OSD3_Px);
2862   2                              WriteWordIIC563(0x084,0);
2863   2                              OpenWindow(WINDOW1,0,29,0,4,atWIN_TRANSLUCENT,ChannelColor);
2864   2      
2865   2                              WriteIIC563(0x090,0x03);  // OSD zooming on
2866   2                              WriteIIC563(0x095,0xFF); // OSD Font Zoowing On
2867   2                              WriteIIC563(0xC2,0x1); // 0 Row Border enable 
2868   2                              WriteWordIIC563(0xcc,ChannelColor);
2869   2              }
2870   1              else{
2871   2                              IR_Number = IR_Number * 10;
2872   2                              IR_Number += No;
2873   2              }
2874   1                      
2875   1              if((Read24C16(ep_Input_CH_Sys) & 0x80)!= 0) { // cable
2876   2                      if(IR_Number <CATV_Max){
2877   3                              if(IR_Number_cnt ==3) {
2878   4                                      ForceToBackground(0,0,0);
2879   4                                      WriteWordIIC563(0xcc,ChannelColor);
2880   4                                      ShowSource_Video();
2881   4                                      ChBuffer = IR_Number;
2882   4                                      FuncPtr = pVIDEOSOURCE;
2883   4                                      ShowValue(ROW0+7,ChannelColor,ChBuffer);
2884   4                                      ChannelSel(ChBuffer);
2885   4                                      Write24C16(0x209,ChBuffer);
2886   4                                      Sleep(100);
2887   4                                      SetDisplayNormal_Video();
2888   4                                      OsdTimer = 500;
2889   4                                      Osd_On(enOSD); //OSD ON
2890   4                              }
2891   3                              else{
2892   4                                      ShowDigital(IR_Number,1);
2893   4                                      Osd_On(enOSD); //OSD ON
2894   4                              }
2895   3                      }
2896   2                      else {
2897   3                              IR_Number_cnt = 0;
2898   3                              Osd_Off();
2899   3                      }
2900   2                      if((IR_Number_cnt ==3)&&(IR_Number <CATV_Min)){
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 48  

2901   3                              IR_Number_cnt = 0;
2902   3                              Osd_Off();
2903   3                      }
2904   2              }
2905   1              else {  
2906   2                      if(IR_Number <TV_Max){
2907   3                              if(IR_Number_cnt ==2) {
2908   4                                      ForceToBackground(0,0,0);
2909   4                                      WriteWordIIC563(0xcc,ChannelColor);
2910   4                                      ShowSource_Video();
2911   4                                      ChBuffer = IR_Number;
2912   4                                      FuncPtr = pVIDEOSOURCE;
2913   4                                      ShowValue(ROW0+7,ChannelColor,ChBuffer);
2914   4                                      ChannelSel(ChBuffer);
2915   4                                      Write24C16(0x209,ChBuffer);
2916   4                                      Sleep(100);
2917   4                                      SetDisplayNormal_Video();
2918   4                                      OsdTimer= 500;
2919   4                                      Osd_On(enOSD); //OSD ON
2920   4                              }
2921   3                              else{
2922   4                                      ShowDigital(IR_Number,0);
2923   4                                      Osd_On(enOSD); //OSD ON
2924   4                              }
2925   3                      }
2926   2                      else {
2927   3                              IR_Number_cnt = 0;
2928   3                              Osd_Off();
2929   3                      }
2930   2                      if((IR_Number_cnt ==2)&&(IR_Number <TV_Min)){
2931   3                              IR_Number_cnt = 0;
2932   3                              Osd_Off();
2933   3                      }
2934   2              }
2935   1      }
2936          void ShowDigital(unsigned short value,unsigned char Cable)
2937          {
2938   1      unsigned char i,ch;
2939   1      unsigned char buff[3];
2940   1      //      sprintf(buff,"%3d",(unsigned short)value);
2941   1      //show value
2942   1              CheckRegPage(0xe0);
2943   1              IIC_Start();
2944   1              IIC_Tx(SCALER_ADDR);
2945   1              IIC_Tx(0xe0);
2946   1              IIC_Tx(tySRAM_CODE_CC_CD&(~tyWITH_LANGTH));
2947   1              IIC_Tx((ROW0+7)&0x00ff);
2948   1              IIC_Tx((ROW0+7)>>8);
2949   1              if(Cable){ // cable
2950   2                      if(value <10){
2951   3                                      if(IR_Number_cnt ==1){
2952   4                                              buff[0] = buff[2];
2953   4                                              buff[1] = '-';
2954   4                                              buff[2] = '-';
2955   4                                      }
2956   3                                      else if(IR_Number_cnt ==2){
2957   4                                              buff[0] = '0';
2958   4                                              buff[1] = buff[2];
2959   4                                              buff[2] = '-';
2960   4                                      }
2961   3                                      else if(IR_Number_cnt ==3){
2962   4                                              buff[0] = '0';
C51 COMPILER V7.03   OSD                                                                   12/21/2006 18:12:27 PAGE 49  

2963   4                                              buff[1] = '0';
2964   4                                              buff[2] =buff[2];
2965   4                                      }
2966   3                      }
2967   2                      else if(value <100){
2968   3                                      if(IR_Number_cnt ==2){
2969   4                                              buff[0] = buff[1];
2970   4                                              buff[1] = buff[2];
2971   4                                              buff[2] = '-';
2972   4                                      }
2973   3                                      else if(IR_Number_cnt == 3){
2974   4                                              buff[0] = '0';
2975   4                                              buff[1] = buff[1];
2976   4                                              buff[2] = buff[2];
2977   4                                      }
2978   3                      }
2979   2                      for(i=0; i<3; i++){
2980   3                              ch = buff[i];
2981   3                              IIC_Tx(ch);
2982   3                      }
2983   2              }
2984   1              else{   // Air
2985   2                      if(value <10){
2986   3                                      if(IR_Number_cnt ==1){
2987   4                                              buff[0] = buff[2];
2988   4                                              buff[1] = '-';
2989   4                                      }
2990   3                                      else{
2991   4                                              buff[0] = '0';
2992   4                                              buff[1] = buff[2];
2993   4                                      }
2994   3                      }
2995   2                      else if(value <100){
2996   3                                      buff[0] = buff[1];
2997   3                                      buff[1] = buff[2];
2998   3                      }
2999   2                      else return;
3000   2                      for(i=0; i<2; i++){
3001   3                              ch = buff[i];
3002   3                              IIC_Tx(ch);
3003   3                      }
3004   2      
3005   2              }
3006   1              IIC_Stop();
3007   1      
3008   1      }
3009          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =  12574    ----
   CONSTANT SIZE    =   1373    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----     305
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
